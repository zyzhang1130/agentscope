<!-- layout.html -->
<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Distribution &mdash; AgentScope  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=c9484b72" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="https://unpkg.com/mermaid@10.2.0/dist/mermaid.min.js"></script>
        <script>mermaid.initialize({startOnLoad:true});</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="AgentScope Studio" href="209-gui.html" />
    <link rel="prev" title="Pipeline and MsgHub" href="202-pipeline.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" > 

          
          
          <a href="../index.html" class="icon icon-home">
            AgentScope
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div> <!-- language_selector.html -->
<div class="language-selector">
    <a href="../../en/tutorial/208-distribute.html">English</a></li> |
    <a href="../../zh_CN/tutorial/208-distribute.html">中文</a></li>
</div> 
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">AgentScope Tutorial</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="101-agentscope.html">About AgentScope</a></li>
<li class="toctree-l1"><a class="reference internal" href="102-installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="103-example.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="203-model.html">Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="203-stream.html">Streaming</a></li>
<li class="toctree-l1"><a class="reference internal" href="206-prompt.html">Prompt Engineering</a></li>
<li class="toctree-l1"><a class="reference internal" href="201-agent.html">Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="205-memory.html">Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="203-parser.html">Response Parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="209-prompt_opt.html">System Prompt Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="204-service.html">Tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="202-pipeline.html">Pipeline and MsgHub</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Distribution</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#implementation">Implementation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="209-gui.html">AgentScope Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="210-rag.html">A Quick Introduction to RAG in AgentScope</a></li>
<li class="toctree-l1"><a class="reference internal" href="105-logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="207-monitor.html">Monitor</a></li>
<li class="toctree-l1"><a class="reference internal" href="104-usecase.html">Example: Werewolf Game</a></li>
<li class="toctree-l1"><a class="reference internal" href="contribute.html">Get Involved</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AgentScope API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.html">agentscope package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.message.html">agentscope.message package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.models.html">agentscope.models package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.agents.html">agentscope.agents package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.memory.html">agentscope.memory package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.parsers.html">agentscope.parsers package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.exception.html">agentscope.exception module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.pipelines.html">agentscope.pipelines package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.service.html">agentscope.service package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.rpc.html">agentscope.rpc package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.server.html">agentscope.server package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.web.html">agentscope.web package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.prompt.html">agentscope.prompt package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.utils.html">agentscope.utils package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AgentScope</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Distribution</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorial/208-distribute.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="distribution">
<span id="distribute-en"></span><h1>Distribution<a class="headerlink" href="#distribution" title="Link to this heading"></a></h1>
<p>AgentScope implements an Actor-based distributed deployment and parallel optimization, providing the following features:</p>
<ul class="simple">
<li><p><strong>Automatic Parallel Optimization</strong>: Automatically optimize the application for parallelism at runtime without additional optimization costs;</p></li>
<li><p><strong>Centralized Application Writing</strong>: Easily orchestrate distributed application flow without distributed background knowledge;</p></li>
<li><p><strong>Zero-Cost Automatic Migration</strong>: Centralized Multi-Agent applications can be easily converted to distributed mode</p></li>
</ul>
<p>This tutorial will introduce the implementation and usage of AgentScope distributed in detail.</p>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Link to this heading"></a></h2>
<p>In AgentScope, the process that runs the application flow is called the <strong>main process</strong>, and each agent can run in a separate process named <strong>agent server process</strong>.
According to the different relationships between the main process and the agent server process, AgentScope supports two modes for each agent: <strong>Child Process</strong> and <strong>Independent Process</strong> mode.</p>
<ul class="simple">
<li><p>In the Child Process Mode, agent server processes will be automatically started as sub-processes from the main process.</p></li>
<li><p>While in the Independent Process Mode, the agent server process is independent of the main process and developers need to start the agent server process on the corresponding machine.</p></li>
</ul>
<p>The above concepts may seem complex, but don’t worry, for application developers, you only need to convert your existing agent to its distributed version.</p>
<section id="step-1-convert-your-agent-to-its-distributed-version">
<h3>Step 1: Convert your agent to its distributed version<a class="headerlink" href="#step-1-convert-your-agent-to-its-distributed-version" title="Link to this heading"></a></h3>
<p>All agents in AgentScope can automatically convert to its distributed version by calling its <a class="reference internal" href="../agentscope.agents.html#agentscope.agents.AgentBase.to_dist" title="agentscope.agents.AgentBase.to_dist"><code class="xref py py-func docutils literal notranslate"><span class="pre">to_dist</span></code></a> method.
But note that your agent must inherit from the <a class="reference internal" href="../agentscope.agents.html#agentscope.agents.AgentBase" title="agentscope.agents.AgentBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">agentscope.agents.AgentBase</span></code></a> class, because the <code class="docutils literal notranslate"><span class="pre">to_dist</span></code> method is provided by the <code class="docutils literal notranslate"><span class="pre">AgentBase</span></code> class.</p>
<p>Suppose there are two agent classes <code class="docutils literal notranslate"><span class="pre">AgentA</span></code> and <code class="docutils literal notranslate"><span class="pre">AgentB</span></code>, both of which inherit from <code class="docutils literal notranslate"><span class="pre">AgentBase</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">AgentA</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;A&quot;</span>
    <span class="c1"># ...</span>
<span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">AgentB</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;B&quot;</span>
    <span class="c1"># ...</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Next we will introduce the conversion details of both modes.</p>
<section id="child-process-mode">
<h4>Child Process Mode<a class="headerlink" href="#child-process-mode" title="Link to this heading"></a></h4>
<p>To use this mode, you only need to call each agent’s <code class="docutils literal notranslate"><span class="pre">to_dist()</span></code> method without any input parameter. AgentScope will automatically start all agent server processes from the main process.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Child Process mode</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">AgentA</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;A&quot;</span>
    <span class="c1"># ...</span>
<span class="p">)</span><span class="o">.</span><span class="n">to_dist</span><span class="p">()</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">AgentB</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;B&quot;</span>
    <span class="c1"># ...</span>
<span class="p">)</span><span class="o">.</span><span class="n">to_dist</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="independent-process-mode">
<h4>Independent Process Mode<a class="headerlink" href="#independent-process-mode" title="Link to this heading"></a></h4>
<p>In the Independent Process Mode, we need to start the agent server process on the target machine first.
When starting the agent server process, you need to specify a model config file, which contains the models which can be used in the agent server, the IP address and port of the agent server process
For example, start two agent server processes on the two different machines with IP <code class="docutils literal notranslate"><span class="pre">ip_a</span></code> and <code class="docutils literal notranslate"><span class="pre">ip_b</span></code>(called <code class="docutils literal notranslate"><span class="pre">Machine1</span></code> and <code class="docutils literal notranslate"><span class="pre">Machine2</span></code> accrodingly).
You can run the following code on <code class="docutils literal notranslate"><span class="pre">Machine1</span></code>.Before running, make sure that the machine has access to all models that used in your application, specifically, you need to put your model config file in <code class="docutils literal notranslate"><span class="pre">model_config_path_a</span></code> and set environment variables such as your model API key correctly in <code class="docutils literal notranslate"><span class="pre">Machine1</span></code>. The example model config file instances are located under <code class="docutils literal notranslate"><span class="pre">examples/model_configs_template</span></code>. In addition, your customized agent classes that need to run in the server must be registered in <code class="docutils literal notranslate"><span class="pre">custom_agent_classes</span></code> so that the server can correctly identify these agents. If you only use AgentScope’s built-in agents, you can ignore <code class="docutils literal notranslate"><span class="pre">custom_agent_classes</span></code> field.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># import some packages</span>

<span class="c1"># register models which can be used in the server</span>
<span class="n">agentscope</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
    <span class="n">model_configs</span><span class="o">=</span><span class="n">model_config_path_a</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># Create an agent service process</span>
<span class="n">server</span> <span class="o">=</span> <span class="n">RpcAgentServerLauncher</span><span class="p">(</span>
    <span class="n">host</span><span class="o">=</span><span class="s2">&quot;ip_a&quot;</span><span class="p">,</span>
    <span class="n">port</span><span class="o">=</span><span class="mi">12001</span><span class="p">,</span>  <span class="c1"># choose an available port</span>
    <span class="n">custom_agent_classes</span><span class="o">=</span><span class="p">[</span><span class="n">AgentA</span><span class="p">,</span> <span class="n">AgentB</span><span class="p">]</span> <span class="c1"># register your customized agent classes</span>
<span class="p">)</span>

<span class="c1"># Start the service</span>
<span class="n">server</span><span class="o">.</span><span class="n">launch</span><span class="p">()</span>
<span class="n">server</span><span class="o">.</span><span class="n">wait_until_terminate</span><span class="p">()</span>
</pre></div>
</div>
<p>For simplicity, you can run the following command in your terminal rather than the above code:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>as_server<span class="w"> </span>--host<span class="w"> </span>ip_a<span class="w"> </span>--port<span class="w"> </span><span class="m">12001</span><span class="w"> </span>--model-config-path<span class="w"> </span>model_config_path_a<span class="w">  </span>--agent-dir<span class="w"> </span>parent_dir_of_agent_a_and_b
</pre></div>
</div>
<blockquote>
<div><p>Note:
The <code class="docutils literal notranslate"><span class="pre">--agent-dir</span></code> field is used to specify the directory where your customized agent classes are located.
Please make sure that all custom Agent classes are located in <code class="docutils literal notranslate"><span class="pre">--agent-dir</span></code>, and that the custom modules they depend on are also located in the directory.
Additionally, because the above command will load all Python files in the directory, please ensure that the directory does not contain any malicious files to avoid security risks.</p>
</div></blockquote>
<p>Then put your model config file accordingly in <code class="docutils literal notranslate"><span class="pre">model_config_path_b</span></code>, set environment variables, and run the following code on <code class="docutils literal notranslate"><span class="pre">Machine2</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># import some packages</span>

<span class="c1"># register models which can be used in the server</span>
<span class="n">agentscope</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
    <span class="n">model_configs</span><span class="o">=</span><span class="n">model_config_path_b</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># Create an agent service process</span>
<span class="n">server</span> <span class="o">=</span> <span class="n">RpcAgentServerLauncher</span><span class="p">(</span>
    <span class="n">host</span><span class="o">=</span><span class="s2">&quot;ip_b&quot;</span><span class="p">,</span>
    <span class="n">port</span><span class="o">=</span><span class="mi">12002</span><span class="p">,</span> <span class="c1"># choose an available port</span>
    <span class="n">custom_agent_classes</span><span class="o">=</span><span class="p">[</span><span class="n">AgentA</span><span class="p">,</span> <span class="n">AgentB</span><span class="p">]</span> <span class="c1"># register your customized agent classes</span>
<span class="p">)</span>

<span class="c1"># Start the service</span>
<span class="n">server</span><span class="o">.</span><span class="n">launch</span><span class="p">()</span>
<span class="n">server</span><span class="o">.</span><span class="n">wait_until_terminate</span><span class="p">()</span>
</pre></div>
</div>
<blockquote>
<div><p>Similarly, you can run the following command in your terminal to setup the agent server:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>as_server<span class="w"> </span>--host<span class="w"> </span>ip_b<span class="w"> </span>--port<span class="w"> </span><span class="m">12002</span><span class="w"> </span>--model-config-path<span class="w"> </span>model_config_path_b<span class="w"> </span>--agent-dir<span class="w"> </span>parent_dir_of_agent_a_and_b
</pre></div>
</div>
</div></blockquote>
<p>Then, you can connect to the agent servers from the main process with the following code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">AgentA</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
    <span class="c1"># ...</span>
<span class="p">)</span><span class="o">.</span><span class="n">to_dist</span><span class="p">(</span>
    <span class="n">host</span><span class="o">=</span><span class="s2">&quot;ip_a&quot;</span><span class="p">,</span>
    <span class="n">port</span><span class="o">=</span><span class="mi">12001</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">AgentB</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">,</span>
    <span class="c1"># ...</span>
<span class="p">)</span><span class="o">.</span><span class="n">to_dist</span><span class="p">(</span>
    <span class="n">host</span><span class="o">=</span><span class="s2">&quot;ip_b&quot;</span><span class="p">,</span>
    <span class="n">port</span><span class="o">=</span><span class="mi">12002</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The above code will deploy <code class="docutils literal notranslate"><span class="pre">AgentA</span></code> on the agent server process of <code class="docutils literal notranslate"><span class="pre">Machine1</span></code> and <code class="docutils literal notranslate"><span class="pre">AgentB</span></code> on the agent server process of <code class="docutils literal notranslate"><span class="pre">Machine2</span></code>.
And developers just need to write the application flow in a centralized way in the main process.</p>
</section>
</section>
<section id="step-2-orchestrate-distributed-application-flow">
<h3>Step 2: Orchestrate Distributed Application Flow<a class="headerlink" href="#step-2-orchestrate-distributed-application-flow" title="Link to this heading"></a></h3>
<blockquote>
<div><p>Note:
Currently, distributed version of Agent only supports <code class="docutils literal notranslate"><span class="pre">__call__</span></code> method call (i.e. <code class="docutils literal notranslate"><span class="pre">agent(x)</span></code>), not support calling other methods or reading/writing properties.</p>
</div></blockquote>
<p>In AgentScope, the orchestration of distributed application flow is exactly the same as non-distributed programs, and developers can write the entire application flow in a centralized way.
At the same time, AgentScope allows the use of a mixture of locally and distributed deployed agents, and developers do not need to distinguish which agents are local and which are distributed.</p>
<p>The following is the complete code for two agents to communicate with each other in different modes. It can be seen that AgentScope supports zero-cost migration of distributed application flow from centralized to distributed.</p>
<ul class="simple">
<li><p>All agents are centralized</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create agent objects</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">AgentA</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
    <span class="c1"># ...</span>
<span class="p">)</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">AgentB</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">,</span>
    <span class="c1"># ...</span>
<span class="p">)</span>

<span class="c1"># Application flow orchestration</span>
<span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">while</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">content</span> <span class="o">==</span> <span class="s2">&quot;exit&quot;</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">b</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Agents are deployed in a distributed manner</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">AgentA</span></code> in Child Process mode</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AgentB</span></code> in Independent Process Mode</p></li>
</ul>
</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create agent objects</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">AgentA</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;A&quot;</span>
    <span class="c1"># ...</span>
<span class="p">)</span><span class="o">.</span><span class="n">to_dist</span><span class="p">()</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">AgentB</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">,</span>
    <span class="c1"># ...</span>
<span class="p">)</span><span class="o">.</span><span class="n">to_dist</span><span class="p">(</span>
    <span class="n">host</span><span class="o">=</span><span class="s2">&quot;ip_b&quot;</span><span class="p">,</span>
    <span class="n">port</span><span class="o">=</span><span class="mi">12002</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Application flow orchestration</span>
<span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">while</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">content</span> <span class="o">==</span> <span class="s2">&quot;exit&quot;</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">b</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="advanced-usage">
<h3>Advanced Usage<a class="headerlink" href="#advanced-usage" title="Link to this heading"></a></h3>
<section id="to-dist-with-lower-cost">
<h4><code class="docutils literal notranslate"><span class="pre">to_dist</span></code> with lower cost<a class="headerlink" href="#to-dist-with-lower-cost" title="Link to this heading"></a></h4>
<p>All examples described above convert initialized agents into their distributed version through the <a class="reference internal" href="../agentscope.agents.html#agentscope.agents.AgentBase.to_dist" title="agentscope.agents.AgentBase.to_dist"><code class="xref py py-func docutils literal notranslate"><span class="pre">to_dist</span></code></a> method, which is equivalent to initialize the agent twice, once in the main process and once in the agent server process.
For agents whose initialization process is time-consuming, the <code class="docutils literal notranslate"><span class="pre">to_dist</span></code> method is inefficient. Therefore, AgentScope also provides a method to convert the Agent instance into its distributed version while initializing it, that is, passing in <code class="docutils literal notranslate"><span class="pre">to_dist</span></code> parameter to the Agent’s initialization function.</p>
<p>In Child Process Mode, just pass <code class="docutils literal notranslate"><span class="pre">to_dist=True</span></code> to the Agent’s initialization function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Child Process mode</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">AgentA</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
    <span class="c1"># ...</span>
    <span class="n">to_dist</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">AgentB</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">,</span>
    <span class="c1"># ...</span>
    <span class="n">to_dist</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
<p>In Independent Process Mode, you need to encapsulate the parameters of the <code class="docutils literal notranslate"><span class="pre">to_dist()</span></code> method in  <a class="reference internal" href="../agentscope.agents.html#agentscope.agents.DistConf" title="agentscope.agents.DistConf"><code class="xref py py-class docutils literal notranslate"><span class="pre">DistConf</span></code></a> instance and pass it into the <code class="docutils literal notranslate"><span class="pre">to_dist</span></code> field, for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">AgentA</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
    <span class="c1"># ...</span>
    <span class="n">to_dist</span><span class="o">=</span><span class="n">DistConf</span><span class="p">(</span>
        <span class="n">host</span><span class="o">=</span><span class="s2">&quot;ip_a&quot;</span><span class="p">,</span>
        <span class="n">port</span><span class="o">=</span><span class="mi">12001</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">AgentB</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">,</span>
    <span class="c1"># ...</span>
    <span class="n">to_dist</span><span class="o">=</span><span class="n">DistConf</span><span class="p">(</span>
        <span class="n">host</span><span class="o">=</span><span class="s2">&quot;ip_b&quot;</span><span class="p">,</span>
        <span class="n">port</span><span class="o">=</span><span class="mi">12002</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Compared with the original <code class="docutils literal notranslate"><span class="pre">to_dist()</span></code> function call, this method just initializes the agent once in the agent server process, which reduces the cost of initialization.</p>
</section>
<section id="manage-your-agent-server-processes">
<h4>Manage your agent server processes<a class="headerlink" href="#manage-your-agent-server-processes" title="Link to this heading"></a></h4>
<p>When running large-scale multi-agent applications, it’s common to have multiple Agent Server processes running. To facilitate management of these processes, AgentScope offers management interfaces in the <a class="reference internal" href="../agentscope.rpc.html#agentscope.rpc.RpcAgentClient" title="agentscope.rpc.RpcAgentClient"><code class="xref py py-class docutils literal notranslate"><span class="pre">RpcAgentClient</span></code></a> class. Here’s a brief overview of these methods:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">is_alive</span></code>: This method checks whether the Agent Server process is still running.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">client</span> <span class="o">=</span> <span class="n">RpcAgentClient</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">server_host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">server_port</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">client</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
        <span class="n">do_something</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">stop</span></code>: This method stops the Agent Server process.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">client</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">is_alive</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_agent_list</span></code>: This method retrieves a list of JSON format thumbnails of all agents currently running within the Agent Server process. The thumbnail is generated by the <code class="docutils literal notranslate"><span class="pre">__str__</span></code> method of the Agent instance.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">agent_list</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_agent_list</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">agent_list</span><span class="p">)</span>  <span class="c1"># [agent1_info, agent2_info, ...]</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_agent_memory</span></code>: With this method, you can fetch the memory content of an agent specified by its <code class="docutils literal notranslate"><span class="pre">agent_id</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">agent_id</span> <span class="o">=</span> <span class="n">my_agent</span><span class="o">.</span><span class="n">agent_id</span>
    <span class="n">agent_memory</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_agent_memory</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">agent_memory</span><span class="p">)</span> <span class="c1"># [msg1, msg2, ...]</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_server_info</span></code>：This method provides information about the resource utilization of the Agent Server process, including CPU usage, memory consumption.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">server_info</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_server_info</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">server_info</span><span class="p">)</span>  <span class="c1"># { &quot;cpu&quot;: xxx, &quot;mem&quot;: xxx }</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">set_model_configs</span></code>: This method set the specific model configs into the agent server, the agent created later can directly use these model configs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">agent</span> <span class="o">=</span> <span class="n">MyAgent</span><span class="p">(</span>  <span class="c1"># failed because the model config [my_openai] is not found</span>
        <span class="c1"># ...</span>
        <span class="n">model_config_name</span><span class="o">=</span><span class="s2">&quot;my_openai&quot;</span><span class="p">,</span>
        <span class="n">to_dist</span><span class="o">=</span><span class="p">{</span>
            <span class="c1"># ...</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="n">client</span><span class="o">.</span><span class="n">set_model_configs</span><span class="p">([{</span>  <span class="c1"># set the model config [my_openai]</span>
        <span class="s2">&quot;config_name&quot;</span><span class="p">:</span> <span class="s2">&quot;my_openai&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model_type&quot;</span><span class="p">:</span> <span class="s2">&quot;openai_chat&quot;</span><span class="p">,</span>
        <span class="c1"># ...</span>
    <span class="p">}])</span>
    <span class="n">agent</span> <span class="o">=</span> <span class="n">MyAgent</span><span class="p">(</span>  <span class="c1"># success</span>
        <span class="c1"># ...</span>
        <span class="n">model_config_name</span><span class="o">=</span><span class="s2">&quot;my_openai&quot;</span><span class="p">,</span>
        <span class="n">to_dist</span><span class="o">=</span><span class="p">{</span>
            <span class="c1"># ...</span>
        <span class="p">}</span>
    <span class="p">)</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">delete_agent</span></code>: This method deletes an agent specified by its <code class="docutils literal notranslate"><span class="pre">agent_id</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">agent_id</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">agent_id</span>
    <span class="n">ok</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">delete_agent</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">delete_all_agent</span></code>: This method deletes all agents currently running within the Agent Server process.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">ok</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">delete_all_agent</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="connecting-to-agentscope-studio">
<h4>Connecting to AgentScope Studio<a class="headerlink" href="#connecting-to-agentscope-studio" title="Link to this heading"></a></h4>
<p>The agent server process can be connected to <a class="reference internal" href="209-gui.html#gui-en"><span class="std std-ref">AgentScope Studio</span></a> at startup, allowing the <code class="docutils literal notranslate"><span class="pre">to_dist</span></code> method in subsequent distributed applications to be assigned automatically by Studio without the need for any parameters.</p>
<p>For scenarios where the agent server process is started using Python code, simply fill in the <code class="docutils literal notranslate"><span class="pre">studio_url</span></code> in the initialization parameters of <code class="docutils literal notranslate"><span class="pre">RpcAgentServerLauncher</span></code>. This requires that the URL is correct and accessible over the network, for example, the default URL for the Studio is <code class="docutils literal notranslate"><span class="pre">http://127.0.0.1:5000</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># import some packages</span>

<span class="c1"># register models which can be used in the server</span>
<span class="n">agentscope</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
    <span class="n">model_configs</span><span class="o">=</span><span class="n">model_config_path_a</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># Create an agent service process</span>
<span class="n">server</span> <span class="o">=</span> <span class="n">RpcAgentServerLauncher</span><span class="p">(</span>
    <span class="n">host</span><span class="o">=</span><span class="s2">&quot;ip_a&quot;</span><span class="p">,</span>
    <span class="n">port</span><span class="o">=</span><span class="mi">12001</span><span class="p">,</span>  <span class="c1"># choose an available port</span>
    <span class="n">custom_agent_classes</span><span class="o">=</span><span class="p">[</span><span class="o">...</span><span class="p">],</span> <span class="c1"># register your customized agent classes</span>
    <span class="n">studio_url</span><span class="o">=</span><span class="s2">&quot;http://studio_ip:studio_port&quot;</span><span class="p">,</span>  <span class="c1"># connect to AgentScope Studio</span>
<span class="p">)</span>

<span class="c1"># Start the service</span>
<span class="n">server</span><span class="o">.</span><span class="n">launch</span><span class="p">()</span>
<span class="n">server</span><span class="o">.</span><span class="n">wait_until_terminate</span><span class="p">()</span>
</pre></div>
</div>
<p>For scenarios using the command <code class="docutils literal notranslate"><span class="pre">as_server</span></code> in your command line, simply fill in the <code class="docutils literal notranslate"><span class="pre">--studio-url</span></code> parameter.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>as_server<span class="w"> </span>--host<span class="w"> </span>ip_a<span class="w"> </span>--port<span class="w"> </span><span class="m">12001</span><span class="w"> </span>--model-config-path<span class="w"> </span>model_config_path_a<span class="w"> </span>--agent-dir<span class="w"> </span>parent_dir_of_agent_a_and_b<span class="w"> </span>--studio-url<span class="w"> </span>http://studio_ip:studio_port
</pre></div>
</div>
<p>After executing the above code or command, you can enter the Server Manager page of AgentScope Studio to check if the connection is successful. If the connection is successful, the agent server process will be displayed in the page table, and you can observe the running status and resource occupation of the process in the page, then you can use the advanced functions brought by AgentScope Studio. This section will focus on the impact of <code class="docutils literal notranslate"><span class="pre">to_dist</span></code> method brought by AgentScope Studio, and please refer to <a class="reference internal" href="209-gui.html#gui-en"><span class="std std-ref">AgentScope Studio</span></a> for the specific usage of the page.</p>
<p>After the agent server process successfully connects to Studio, you only need to pass the <code class="docutils literal notranslate"><span class="pre">studio_url</span></code> of this Studio in the <code class="docutils literal notranslate"><span class="pre">agentscope.init</span></code> method, and then the <code class="docutils literal notranslate"><span class="pre">to_dist</span></code> method no longer needs to fill in the <code class="docutils literal notranslate"><span class="pre">host</span></code> and <code class="docutils literal notranslate"><span class="pre">port</span></code> fields, but automatically select an agent server process that has been connected to Studio.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># import some packages</span>

<span class="n">agentscope</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
    <span class="n">model_configs</span><span class="o">=</span><span class="n">model_config_path_a</span><span class="p">,</span>
    <span class="n">studio_url</span><span class="o">=</span><span class="s2">&quot;http://studio_ip:studio_port&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">AgentA</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;A&quot;</span>
    <span class="c1"># ...</span>
<span class="p">)</span><span class="o">.</span><span class="n">to_dist</span><span class="p">()</span> <span class="c1"># automatically select an agent server</span>

<span class="c1"># your application code</span>
</pre></div>
</div>
<blockquote>
<div><p>Note:</p>
<ul class="simple">
<li><p>The Agent used in this method must be registered at the start of the agent server process through <code class="docutils literal notranslate"><span class="pre">custom_agent_classes</span></code> or <code class="docutils literal notranslate"><span class="pre">--agent-dir</span></code>.</p></li>
<li><p>When using this method, make sure that the agent server process connected to Studio is still running normally.</p></li>
</ul>
</div></blockquote>
<p>After the application starts running, you can observe in the Server Manager page of Studio which agent server process this Agent is specifically running on, and after the application is completed, you can also delete this Agent through the Server Manager page.</p>
</section>
</section>
</section>
<section id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Link to this heading"></a></h2>
<section id="actor-model">
<h3>Actor Model<a class="headerlink" href="#actor-model" title="Link to this heading"></a></h3>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Actor_model">The Actor model</a> is a widely used programming paradigm in large-scale distributed systems, and it is also applied in the distributed design of the AgentScope platform.</p>
<p>In the distributed mode of AgentScope, each Agent is an Actor and interacts with other Agents through messages. The flow of messages implies the execution order of the Agents. Each Agent has a <code class="docutils literal notranslate"><span class="pre">reply</span></code> method, which consumes a message and generates another message, and the generated message can be sent to other Agents. For example, the following chart shows the workflow of multiple Agents. <code class="docutils literal notranslate"><span class="pre">A</span></code>~<code class="docutils literal notranslate"><span class="pre">F</span></code> are all Agents, and the arrows represent messages.</p>
<div class="mermaid">
            graph LR;
A--&gt;B
A--&gt;C
B--&gt;D
C--&gt;D
E--&gt;F
D--&gt;F
        </div><p>Specifically, <code class="docutils literal notranslate"><span class="pre">B</span></code> and <code class="docutils literal notranslate"><span class="pre">C</span></code> can start execution simultaneously after receiving the message from <code class="docutils literal notranslate"><span class="pre">A</span></code>, and <code class="docutils literal notranslate"><span class="pre">E</span></code> can run immediately without waiting for <code class="docutils literal notranslate"><span class="pre">A</span></code>, <code class="docutils literal notranslate"><span class="pre">B</span></code>, <code class="docutils literal notranslate"><span class="pre">C</span></code>, and <code class="docutils literal notranslate"><span class="pre">D</span></code>.
By implementing each Agent as an Actor, an Agent will automatically wait for its input <code class="docutils literal notranslate"><span class="pre">Msg</span></code> before starting to execute the <code class="docutils literal notranslate"><span class="pre">reply</span></code> method, and multiple Agents can also automatically execute <code class="docutils literal notranslate"><span class="pre">reply</span></code> at the same time if their input messages are ready, which avoids complex parallel control and makes things simple.</p>
</section>
<section id="placeholder">
<h3>PlaceHolder<a class="headerlink" href="#placeholder" title="Link to this heading"></a></h3>
<p>Meanwhile, to support centralized application orchestration, AgentScope introduces the concept of <code class="xref py py-class docutils literal notranslate"><span class="pre">Placeholder</span></code>.
A Placeholder is a special message that contains the address and port number of the agent that generated the placeholder, which is used to indicate that the output message of the Agent is not ready yet.
When calling the <code class="docutils literal notranslate"><span class="pre">reply</span></code> method of a distributed agent, a placeholder is returned immediately without blocking the main process.
The interface of placeholder is exactly the same as the message, so that the orchestration flow can be written in a centralized way.
When getting values from a placeholder, the placeholder will send a request to get the real values from the source agent.
A placeholder itself is also a message, and it can be sent to other agents, and let other agents to get the real values, which can avoid sending the real values multiple times.</p>
<p>About more detailed technical implementation solutions, please refer to our <a class="reference external" href="https://arxiv.org/abs/2402.14034">paper</a>.</p>
</section>
<section id="agent-server">
<h3>Agent Server<a class="headerlink" href="#agent-server" title="Link to this heading"></a></h3>
<p>In agentscope, the agent server provides a running platform for various types of agents.
Multiple agents can run in the same agent server and hold independent memory and other local states but they will share the same computation resources.</p>
<p>After installing the distributed version of AgentScope, you can use the <code class="docutils literal notranslate"><span class="pre">as_server</span></code> command to start the agent server, and the detailed startup arguments can be found in the documentation of the <a class="reference internal" href="../agentscope.server.launcher.html#agentscope.server.launcher.as_server" title="agentscope.server.launcher.as_server"><code class="xref py py-func docutils literal notranslate"><span class="pre">as_server</span></code></a> function.</p>
<p>As long as the code is not modified, an agent server can provide services for multiple main processes.
This means that when running mutliple applications, you only need to start the agent server for the first time, and it can be reused subsequently.</p>
<p><a class="reference internal" href="#distribute-en">[Back to the top]</a></p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="202-pipeline.html" class="btn btn-neutral float-left" title="Pipeline and MsgHub" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="209-gui.html" class="btn btn-neutral float-right" title="AgentScope Studio" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Alibaba Tongyi Lab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>