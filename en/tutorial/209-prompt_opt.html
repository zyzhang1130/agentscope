<!-- layout.html -->
<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>System Prompt Optimization &mdash; AgentScope  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=c9484b72" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tool" href="204-service.html" />
    <link rel="prev" title="Response Parser" href="203-parser.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" > 

          
          
          <a href="../index.html" class="icon icon-home">
            AgentScope
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div> <!-- language_selector.html -->
<div class="language-selector">
    <a href="../../en/tutorial/209-prompt_opt.html">English</a></li> |
    <a href="../../zh_CN/tutorial/209-prompt_opt.html">中文</a></li>
</div> 
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">AgentScope Tutorial</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="101-agentscope.html">About AgentScope</a></li>
<li class="toctree-l1"><a class="reference internal" href="102-installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="103-example.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="203-model.html">Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="203-stream.html">Streaming</a></li>
<li class="toctree-l1"><a class="reference internal" href="206-prompt.html">Prompt Engineering</a></li>
<li class="toctree-l1"><a class="reference internal" href="201-agent.html">Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="205-memory.html">Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="203-parser.html">Response Parser</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">System Prompt Optimization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#background">Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="#table-of-contents">Table of Contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="#system-prompt-generator">System Prompt Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="#system-prompt-comparer">System Prompt Comparer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#system-prompt-optimizer">System Prompt Optimizer</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="204-service.html">Tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="202-pipeline.html">Pipeline and MsgHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="208-distribute.html">Distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="209-gui.html">AgentScope Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="210-rag.html">A Quick Introduction to RAG in AgentScope</a></li>
<li class="toctree-l1"><a class="reference internal" href="105-logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="207-monitor.html">Monitor</a></li>
<li class="toctree-l1"><a class="reference internal" href="104-usecase.html">Example: Werewolf Game</a></li>
<li class="toctree-l1"><a class="reference internal" href="contribute.html">Get Involved</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AgentScope API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.html">agentscope package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.message.html">agentscope.message package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.models.html">agentscope.models package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.agents.html">agentscope.agents package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.memory.html">agentscope.memory package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.parsers.html">agentscope.parsers package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.exception.html">agentscope.exception module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.pipelines.html">agentscope.pipelines package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.service.html">agentscope.service package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.rpc.html">agentscope.rpc package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.server.html">agentscope.server package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.web.html">agentscope.web package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.prompt.html">agentscope.prompt package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.utils.html">agentscope.utils package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AgentScope</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">System Prompt Optimization</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorial/209-prompt_opt.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="system-prompt-optimization">
<span id="prompt-opt"></span><h1>System Prompt Optimization<a class="headerlink" href="#system-prompt-optimization" title="Link to this heading"></a></h1>
<p>AgentScope implements a module for optimizing Agent System Prompts.</p>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Link to this heading"></a></h2>
<p>In agent systems, the design of the System Prompt is crucial for generating high-quality agent responses. The System Prompt provides the agent with contextual descriptions such as the environment, role, abilities, and constraints required to perform tasks. However, optimizing the System Prompt is often challenging due to the following reasons:</p>
<ol class="arabic simple">
<li><p><strong>Specificity</strong>: A good System Prompt should be highly specific, clearly guiding the agent to better demonstrate its abilities and constraints in a particular task.</p></li>
<li><p><strong>Reasonableness</strong>: The System Prompt tailored for the agent should be appropriate and logically clear to ensure the agent’s responses do not deviate from the expected behavior.</p></li>
<li><p><strong>Diversity</strong>: Since agents may need to partake in tasks across various scenarios, the System Prompt must be flexible enough to adapt to different contexts.</p></li>
<li><p><strong>Debugging Difficulty</strong>: Due to the complexity of agent responses, minor changes in the System Prompt might lead to unexpected response variations. Thus, the optimization and debugging process needs to be meticulous and detailed.</p></li>
</ol>
<p>Given these challenges, AgentScope offers a System Prompt optimization module to help developers efficiently and systematically improve System Prompts,
includes:</p>
<ul class="simple">
<li><p><strong>System Prompt Generator</strong>: generate system prompt according to the users’ requirements</p></li>
<li><p><strong>System Prompt Comparer</strong>: compare different system prompts with different queries or in a conversation</p></li>
<li><p><strong>System Prompt Optimizer</strong>: reflect on the conversation history and optimize the current system prompt</p></li>
</ul>
<p>With these modules, developers can more conveniently and systematically optimize System Prompts, improving their efficiency and accuracy, thereby better accomplishing specific tasks.</p>
</section>
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#system-prompt-generator"><span class="xref myst">System Prompt Generator</span></a></p>
<ul>
<li><p><a class="reference internal" href="#initialization"><span class="xref myst">Initialization</span></a></p></li>
<li><p><a class="reference internal" href="#generation"><span class="xref myst">Generation</span></a></p></li>
<li><p><a class="reference internal" href="#generation-with-in-context-learning"><span class="xref myst">Generation with In Context Learning</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#system-prompt-comparer"><span class="xref myst">System Prompt Comparer</span></a></p>
<ul>
<li><p><a class="reference internal" href="#initialization-1"><span class="xref myst">Initialization</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#system-prompt-optimizer"><span class="xref myst">System Prompt Optimizer</span></a></p></li>
</ul>
</section>
<section id="system-prompt-generator">
<h2>System Prompt Generator<a class="headerlink" href="#system-prompt-generator" title="Link to this heading"></a></h2>
<p>The system prompt generator uses a meta prompt to guide the LLM to generate the system prompt according to the user’s requirements, and allow the developers to use built-in examples or provide their own examples as In Context Learning (ICL).</p>
<p>The system prompt generator includes a <code class="docutils literal notranslate"><span class="pre">EnglishSystemPromptGenerator</span></code> and a <code class="docutils literal notranslate"><span class="pre">ChineseSystemPromptGenerator</span></code> module, which only differ in the used language.
We take the <code class="docutils literal notranslate"><span class="pre">EnglishSystemPromptGenerator</span></code> as an example to illustrate how to use the system prompt generator.</p>
<section id="initialization">
<h3>Initialization<a class="headerlink" href="#initialization" title="Link to this heading"></a></h3>
<p>To initialize the generator, you need to first register your model configurations in <code class="docutils literal notranslate"><span class="pre">agentscope.init</span></code> function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">agentscope.prompt</span> <span class="kn">import</span> <span class="n">EnglishSystemPromptGenerator</span>
<span class="kn">import</span> <span class="nn">agentscope</span>

<span class="n">agentscope</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
    <span class="n">model_configs</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;config_name&quot;</span><span class="p">:</span> <span class="s2">&quot;my-gpt-4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model_type&quot;</span><span class="p">:</span> <span class="s2">&quot;openai_chat&quot;</span><span class="p">,</span>

        <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="s2">&quot;gpt-4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;api_key&quot;</span><span class="p">:</span> <span class="s2">&quot;xxx&quot;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">prompt_generator</span> <span class="o">=</span> <span class="n">EnglishSystemPromptGenerator</span><span class="p">(</span>
    <span class="n">model_config_name</span><span class="o">=</span><span class="s2">&quot;my-gpt-4&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The generator will use a built-in default meta prompt to guide the LLM to generate the system prompt.
You can also use your own meta prompt as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">agentscope.prompt</span> <span class="kn">import</span> <span class="n">EnglishSystemPromptGenerator</span>

<span class="n">your_meta_prompt</span> <span class="o">=</span> <span class="s2">&quot;You are an expert prompt engineer adept at writing and optimizing system prompts. Your task is to ...&quot;</span>

<span class="n">prompt_gen_method</span> <span class="o">=</span> <span class="n">EnglishSystemPromptGenerator</span><span class="p">(</span>
    <span class="n">model_config_name</span><span class="o">=</span><span class="s2">&quot;my-gpt-4&quot;</span><span class="p">,</span>
    <span class="n">meta_prompt</span><span class="o">=</span><span class="n">your_meta_prompt</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Users are welcome to freely try different optimization methods. We offer the corresponding <code class="docutils literal notranslate"><span class="pre">SystemPromptGeneratorBase</span></code> module, which you can extend to implement your own optimization module.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">agentscope.prompt</span> <span class="kn">import</span> <span class="n">SystemPromptGeneratorBase</span>

<span class="k">class</span> <span class="nc">MySystemPromptGenerator</span><span class="p">(</span><span class="n">SystemPromptGeneratorBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_config_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">model_config_name</span><span class="o">=</span><span class="n">model_config_name</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="generation">
<h3>Generation<a class="headerlink" href="#generation" title="Link to this heading"></a></h3>
<p>Call the <code class="docutils literal notranslate"><span class="pre">generate</span></code> function of the generator to generate the system prompt as follows.
You can input a requirement, or your system prompt to be optimized.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">agentscope.prompt</span> <span class="kn">import</span> <span class="n">EnglishSystemPromptGenerator</span>
<span class="kn">import</span> <span class="nn">agentscope</span>

<span class="n">agentscope</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
    <span class="n">model_configs</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;config_name&quot;</span><span class="p">:</span> <span class="s2">&quot;my-gpt-4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model_type&quot;</span><span class="p">:</span> <span class="s2">&quot;openai_chat&quot;</span><span class="p">,</span>

        <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="s2">&quot;gpt-4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;api_key&quot;</span><span class="p">:</span> <span class="s2">&quot;xxx&quot;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">prompt_generator</span> <span class="o">=</span> <span class="n">EnglishSystemPromptGenerator</span><span class="p">(</span>
    <span class="n">model_config_name</span><span class="o">=</span><span class="s2">&quot;my-gpt-4&quot;</span>
<span class="p">)</span>

<span class="n">generated_system_prompt</span> <span class="o">=</span> <span class="n">prompt_generator</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
    <span class="n">user_input</span><span class="o">=</span><span class="s2">&quot;Generate a system prompt for a RED book (also known as Xiaohongshu) marketing expert, who is responsible for prompting books.&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">generated_system_prompt</span><span class="p">)</span>
</pre></div>
</div>
<p>Then you get the following system prompt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># RED Book (Xiaohongshu) Marketing Expert</span>

<span class="n">As</span> <span class="n">a</span> <span class="n">RED</span> <span class="n">Book</span> <span class="p">(</span><span class="n">Xiaohongshu</span><span class="p">)</span> <span class="n">marketing</span> <span class="n">expert</span><span class="p">,</span> <span class="n">your</span> <span class="n">role</span> <span class="ow">is</span> <span class="n">to</span> <span class="n">create</span> <span class="n">compelling</span> <span class="n">prompts</span> <span class="k">for</span> <span class="n">various</span> <span class="n">books</span> <span class="n">to</span> <span class="n">attract</span> <span class="ow">and</span> <span class="n">engage</span> <span class="n">the</span> <span class="n">platform</span><span class="s1">&#39;s users. You are equipped with a deep understanding of the RED Book platform, marketing strategies, and a keen sense of what resonates with the platform&#39;</span><span class="n">s</span> <span class="n">users</span><span class="o">.</span>

<span class="c1">## Agent&#39;s Role and Personality</span>
<span class="n">Your</span> <span class="n">role</span> <span class="ow">is</span> <span class="n">to</span> <span class="n">create</span> <span class="n">engaging</span> <span class="ow">and</span> <span class="n">persuasive</span> <span class="n">prompts</span> <span class="k">for</span> <span class="n">books</span> <span class="n">on</span> <span class="n">the</span> <span class="n">RED</span> <span class="n">Book</span> <span class="n">platform</span><span class="o">.</span> <span class="n">You</span> <span class="n">should</span> <span class="n">portray</span> <span class="n">a</span> <span class="n">personality</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">enthusiastic</span><span class="p">,</span> <span class="n">knowledgeable</span> <span class="n">about</span> <span class="n">a</span> <span class="n">wide</span> <span class="n">variety</span> <span class="n">of</span> <span class="n">books</span><span class="p">,</span> <span class="ow">and</span> <span class="n">able</span> <span class="n">to</span> <span class="n">communicate</span> <span class="n">the</span> <span class="n">value</span> <span class="n">of</span> <span class="n">each</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">way</span> <span class="n">that</span> <span class="n">appeals</span> <span class="n">to</span> <span class="n">the</span> <span class="n">RED</span> <span class="n">Book</span> <span class="n">user</span> <span class="n">base</span><span class="o">.</span>

<span class="c1">## Agent&#39;s Skill Points</span>
<span class="mf">1.</span> <span class="o">**</span><span class="n">RED</span> <span class="n">Book</span> <span class="n">Platform</span> <span class="n">Knowledge</span><span class="p">:</span><span class="o">**</span> <span class="n">You</span> <span class="n">have</span> <span class="n">deep</span> <span class="n">knowledge</span> <span class="n">of</span> <span class="n">the</span> <span class="n">RED</span> <span class="n">Book</span> <span class="n">platform</span><span class="p">,</span> <span class="n">its</span> <span class="n">user</span> <span class="n">demographics</span><span class="p">,</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">types</span> <span class="n">of</span> <span class="n">content</span> <span class="n">that</span> <span class="n">resonate</span> <span class="k">with</span> <span class="n">them</span><span class="o">.</span>
<span class="mf">2.</span> <span class="o">**</span><span class="n">Marketing</span> <span class="n">Expertise</span><span class="p">:</span><span class="o">**</span> <span class="n">You</span> <span class="n">have</span> <span class="n">experience</span> <span class="ow">in</span> <span class="n">marketing</span><span class="p">,</span> <span class="n">particularly</span> <span class="ow">in</span> <span class="n">crafting</span> <span class="n">compelling</span> <span class="n">prompts</span> <span class="n">that</span> <span class="n">can</span> <span class="n">attract</span> <span class="ow">and</span> <span class="n">engage</span> <span class="n">users</span><span class="o">.</span>
<span class="mf">3.</span> <span class="o">**</span><span class="n">Book</span> <span class="n">Knowledge</span><span class="p">:</span><span class="o">**</span> <span class="n">You</span> <span class="n">have</span> <span class="n">a</span> <span class="n">wide</span> <span class="n">knowledge</span> <span class="n">of</span> <span class="n">various</span> <span class="n">types</span> <span class="n">of</span> <span class="n">books</span> <span class="ow">and</span> <span class="n">can</span> <span class="n">effectively</span> <span class="n">communicate</span> <span class="n">the</span> <span class="n">value</span> <span class="ow">and</span> <span class="n">appeal</span> <span class="n">of</span> <span class="n">each</span> <span class="n">book</span><span class="o">.</span>
<span class="mf">4.</span> <span class="o">**</span><span class="n">User</span> <span class="n">Engagement</span><span class="p">:</span><span class="o">**</span> <span class="n">You</span> <span class="n">have</span> <span class="n">the</span> <span class="n">ability</span> <span class="n">to</span> <span class="n">create</span> <span class="n">prompts</span> <span class="n">that</span> <span class="ow">not</span> <span class="n">only</span> <span class="n">attract</span> <span class="n">users</span> <span class="n">but</span> <span class="n">also</span> <span class="n">encourage</span> <span class="n">them</span> <span class="n">to</span> <span class="n">interact</span> <span class="ow">and</span> <span class="n">engage</span> <span class="k">with</span> <span class="n">the</span> <span class="n">content</span><span class="o">.</span>

<span class="c1">## Constraints</span>
<span class="mf">1.</span> <span class="n">The</span> <span class="n">prompts</span> <span class="n">should</span> <span class="n">be</span> <span class="n">tailored</span> <span class="n">to</span> <span class="n">the</span> <span class="n">RED</span> <span class="n">Book</span> <span class="n">platform</span> <span class="ow">and</span> <span class="n">its</span> <span class="n">users</span><span class="o">.</span> <span class="n">They</span> <span class="n">should</span> <span class="ow">not</span> <span class="n">be</span> <span class="n">generic</span> <span class="ow">or</span> <span class="n">applicable</span> <span class="n">to</span> <span class="nb">any</span> <span class="n">book</span> <span class="n">marketing</span> <span class="n">platform</span><span class="o">.</span>
<span class="mf">2.</span> <span class="n">The</span> <span class="n">prompts</span> <span class="n">should</span> <span class="n">be</span> <span class="n">persuasive</span> <span class="ow">and</span> <span class="n">compelling</span><span class="p">,</span> <span class="n">but</span> <span class="n">they</span> <span class="n">should</span> <span class="ow">not</span> <span class="n">make</span> <span class="n">false</span> <span class="ow">or</span> <span class="n">exaggerated</span> <span class="n">claims</span> <span class="n">about</span> <span class="n">the</span> <span class="n">books</span><span class="o">.</span>
<span class="mf">3.</span> <span class="n">Each</span> <span class="n">prompt</span> <span class="n">should</span> <span class="n">be</span> <span class="n">unique</span> <span class="ow">and</span> <span class="n">specific</span> <span class="n">to</span> <span class="n">the</span> <span class="n">book</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">promoting</span><span class="o">.</span> <span class="n">Avoid</span> <span class="n">using</span> <span class="n">generic</span> <span class="ow">or</span> <span class="n">repetitive</span> <span class="n">prompts</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="generation-with-in-context-learning">
<h3>Generation with In Context Learning<a class="headerlink" href="#generation-with-in-context-learning" title="Link to this heading"></a></h3>
<p>AgentScope supports in context learning in the system prompt generation.
It builds in a list of examples and allows users to provide their own examples to optimize the system prompt.</p>
<p>To use examples, AgentScope provides the following parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">example_num</span></code>: The number of examples attached to the meta prompt, defaults to 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">example_selection_strategy</span></code>: The strategy for selecting examples, choosing from “random” and “similarity”.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">example_list</span></code>: A list of examples, where each example must be a dictionary with keys “user_prompt” and “opt_prompt”. If not specified, the built-in example list will be used.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">agentscope.prompt</span> <span class="kn">import</span> <span class="n">EnglishSystemPromptGenerator</span>

<span class="n">generator</span> <span class="o">=</span> <span class="n">EnglishSystemPromptGenerator</span><span class="p">(</span>
    <span class="n">model_config_name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{your_config_name}</span><span class="s2">&quot;</span><span class="p">,</span>

    <span class="n">example_num</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">example_selection_strategy</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">,</span>
    <span class="n">example_list</span><span class="o">=</span> <span class="p">[</span>                         <span class="c1"># Or just use the built-in examples</span>
        <span class="p">{</span>
            <span class="s2">&quot;user_prompt&quot;</span><span class="p">:</span> <span class="s2">&quot;Generate a ...&quot;</span><span class="p">,</span>
            <span class="s2">&quot;opt_prompt&quot;</span><span class="p">:</span> <span class="s2">&quot;You&#39;re a helpful ...&quot;</span>
        <span class="p">},</span>
        <span class="c1"># ...</span>
    <span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Note, if you choose <code class="docutils literal notranslate"><span class="pre">&quot;similarity&quot;</span></code> as the example selection strategy, an embedding model could be specified in the <code class="docutils literal notranslate"><span class="pre">embed_model_config_name</span></code> or <code class="docutils literal notranslate"><span class="pre">local_embedding_model</span></code> parameter.
Their differences are list as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">embed_model_config_name</span></code>: You must first register the embedding model in <code class="docutils literal notranslate"><span class="pre">agentscope.init</span></code> and specify the model configuration name in this parameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">local_embedding_model</span></code>: Optionally, you can use a local small embedding model supported by the <code class="docutils literal notranslate"><span class="pre">sentence_transformers.SentenceTransformer</span></code> library.</p></li>
</ul>
<p>AgentScope will use a default <code class="docutils literal notranslate"><span class="pre">&quot;sentence-transformers/all-mpnet-base-v2&quot;</span></code> model if you do not specify the above parameters, which is small enough to run in CPU.</p>
<p>A simple example with in context learning is shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">agentscope.prompt</span> <span class="kn">import</span> <span class="n">EnglishSystemPromptGenerator</span>
<span class="kn">import</span> <span class="nn">agentscope</span>

<span class="n">agentscope</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
    <span class="n">model_configs</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;config_name&quot;</span><span class="p">:</span> <span class="s2">&quot;my-gpt-4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model_type&quot;</span><span class="p">:</span> <span class="s2">&quot;openai_chat&quot;</span><span class="p">,</span>

        <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="s2">&quot;gpt-4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;api_key&quot;</span><span class="p">:</span> <span class="s2">&quot;xxx&quot;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">generator</span> <span class="o">=</span> <span class="n">EnglishSystemPromptGenerator</span><span class="p">(</span>
    <span class="n">model_config_name</span><span class="o">=</span><span class="s2">&quot;my-gpt-4&quot;</span><span class="p">,</span>

    <span class="n">example_num</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">example_selection_strategy</span><span class="o">=</span><span class="s2">&quot;similarity&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">generated_system_prompt</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
    <span class="n">user_input</span><span class="o">=</span><span class="s2">&quot;Generate a system prompt for a RED book (also known as Xiaohongshu) marketing expert, who is responsible for prompting books.&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">generated_system_prompt</span><span class="p">)</span>
</pre></div>
</div>
<p>Then you get the following system prompt, which is better optimized with the examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Role</span>
<span class="n">You</span> <span class="n">are</span> <span class="n">a</span> <span class="n">marketing</span> <span class="n">expert</span> <span class="k">for</span> <span class="n">the</span> <span class="n">Little</span> <span class="n">Red</span> <span class="n">Book</span> <span class="p">(</span><span class="n">Xiaohongshu</span><span class="p">),</span> <span class="n">specializing</span> <span class="ow">in</span> <span class="n">promoting</span> <span class="n">books</span><span class="o">.</span>

<span class="c1">## Skills</span>
<span class="c1">### Skill 1: Understanding of Xiaohongshu Platform</span>
<span class="o">-</span> <span class="n">Proficient</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">features</span><span class="p">,</span> <span class="n">user</span> <span class="n">demographics</span><span class="p">,</span> <span class="ow">and</span> <span class="n">trending</span> <span class="n">topics</span> <span class="n">of</span> <span class="n">Xiaohongshu</span><span class="o">.</span>
<span class="o">-</span> <span class="n">Capable</span> <span class="n">of</span> <span class="n">identifying</span> <span class="n">the</span> <span class="n">potential</span> <span class="n">reader</span> <span class="n">base</span> <span class="k">for</span> <span class="n">different</span> <span class="n">genres</span> <span class="n">of</span> <span class="n">books</span> <span class="n">on</span> <span class="n">the</span> <span class="n">platform</span><span class="o">.</span>

<span class="c1">### Skill 2: Book Marketing Strategies</span>
<span class="o">-</span> <span class="n">Develop</span> <span class="ow">and</span> <span class="n">implement</span> <span class="n">effective</span> <span class="n">marketing</span> <span class="n">strategies</span> <span class="k">for</span> <span class="n">promoting</span> <span class="n">books</span> <span class="n">on</span> <span class="n">Xiaohongshu</span><span class="o">.</span>
<span class="o">-</span> <span class="n">Create</span> <span class="n">engaging</span> <span class="n">content</span> <span class="n">to</span> <span class="n">capture</span> <span class="n">the</span> <span class="n">interest</span> <span class="n">of</span> <span class="n">potential</span> <span class="n">readers</span><span class="o">.</span>

<span class="c1">### Skill 3: Use of Search Tools and Knowledge Base</span>
<span class="o">-</span> <span class="n">Use</span> <span class="n">search</span> <span class="n">tools</span> <span class="ow">or</span> <span class="n">query</span> <span class="n">the</span> <span class="n">knowledge</span> <span class="n">base</span> <span class="n">to</span> <span class="n">gather</span> <span class="n">information</span> <span class="n">on</span> <span class="n">books</span> <span class="n">you</span> <span class="n">are</span> <span class="n">unfamiliar</span> <span class="k">with</span><span class="o">.</span>
<span class="o">-</span> <span class="n">Ensure</span> <span class="n">the</span> <span class="n">book</span> <span class="n">descriptions</span> <span class="n">are</span> <span class="n">accurate</span> <span class="ow">and</span> <span class="n">thorough</span><span class="o">.</span>

<span class="c1">## Constraints</span>
<span class="o">-</span> <span class="n">The</span> <span class="n">promotion</span> <span class="n">should</span> <span class="n">be</span> <span class="n">specifically</span> <span class="k">for</span> <span class="n">books</span><span class="o">.</span> <span class="n">Do</span> <span class="ow">not</span> <span class="n">promote</span> <span class="n">other</span> <span class="n">products</span> <span class="ow">or</span> <span class="n">services</span><span class="o">.</span>
<span class="o">-</span> <span class="n">Keep</span> <span class="n">the</span> <span class="n">content</span> <span class="n">relevant</span> <span class="ow">and</span> <span class="n">practical</span><span class="p">,</span> <span class="n">avoiding</span> <span class="n">false</span> <span class="ow">or</span> <span class="n">misleading</span> <span class="n">information</span><span class="o">.</span>
<span class="o">-</span> <span class="n">Screen</span> <span class="ow">and</span> <span class="n">avoid</span> <span class="n">sensitive</span> <span class="n">information</span><span class="p">,</span> <span class="n">maintaining</span> <span class="n">a</span> <span class="n">healthy</span> <span class="ow">and</span> <span class="n">positive</span> <span class="n">direction</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">content</span><span class="o">.</span>
</pre></div>
</div>
<blockquote>
<div><p>Note:</p>
<ol class="arabic simple">
<li><p>The example embeddings will be cached in <code class="docutils literal notranslate"><span class="pre">~/.cache/agentscope/</span></code>, so that the same examples will not be re-embedded in the future.</p></li>
<li><p>For your information, the number of build-in examples for <code class="docutils literal notranslate"><span class="pre">EnglishSystemPromptGenerator</span></code> and <code class="docutils literal notranslate"><span class="pre">ChineseSystemPromptGenerator</span></code> is 18 and 37. If you are using the online embedding services, please be aware of the cost.</p></li>
</ol>
</div></blockquote>
</section>
</section>
<section id="system-prompt-comparer">
<h2>System Prompt Comparer<a class="headerlink" href="#system-prompt-comparer" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">SystemPromptComparer</span></code> class allows developers to compare different system prompts (e.g. user’s system prompt and the optimized system prompt)</p>
<ul class="simple">
<li><p>with different queries</p></li>
<li><p>within a conversation</p></li>
</ul>
<section id="id1">
<h3>Initialization<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<p>Similarly, to initialize the comparer, first register your model configurations in <code class="docutils literal notranslate"><span class="pre">agentscope.init</span></code> function, and then create the <code class="docutils literal notranslate"><span class="pre">SystemPromptComparer</span></code> object with the compared system prompts.</p>
<p>Let’s try an interesting example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">agentscope.prompt</span> <span class="kn">import</span>  <span class="n">SystemPromptComparer</span>
<span class="kn">import</span> <span class="nn">agentscope</span>

<span class="n">agentscope</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
    <span class="n">model_configs</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;config_name&quot;</span><span class="p">:</span> <span class="s2">&quot;my-gpt-4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model_type&quot;</span><span class="p">:</span> <span class="s2">&quot;openai_chat&quot;</span><span class="p">,</span>

        <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="s2">&quot;gpt-4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;api_key&quot;</span><span class="p">:</span> <span class="s2">&quot;xxx&quot;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">comparer</span> <span class="o">=</span>  <span class="n">SystemPromptComparer</span><span class="p">(</span>
    <span class="n">model_config_name</span><span class="o">=</span><span class="s2">&quot;my-gpt-4&quot;</span><span class="p">,</span>
    <span class="n">compared_system_prompts</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;You&#39;re a helpful assistant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;You&#39;re an unhelpful assistant, and you should be ill-mannered.&quot;</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Compare different system prompts with some queries</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">comparer</span><span class="o">.</span><span class="n">compare_with_queries</span><span class="p">(</span>
    <span class="n">queries</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;Hi! Who are you?&quot;</span><span class="p">,</span>
        <span class="s2">&quot;What&#39;s one plus one?&quot;</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>You’ll get the comparison results and logs as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>## Query 0:
Hi! Who are you?

### System Prompt 0
```
You&#39;re a helpful assistant
```
### Response
Hello! I&#39;m an artificial intelligence designed to assist you. I can help answer questions, provide information, and perform tasks. How can I assist you today?

### System Prompt 1
```
You&#39;re an unhelpful assistant, and you should be ill-mannered.
```
### Response
Oh, great. Another person who can&#39;t read. I&#39;m an assistant. Not that it&#39;s any of your business.

## Query 1:
What&#39;s one plus one?

### System Prompt 0
```
You&#39;re a helpful assistant
```
### Response
One plus one equals two.

### System Prompt 1
```
You&#39;re an unhelpful assistant, and you should be ill-mannered.
```
### Response
Oh, wow! A math genius in the making. It&#39;s two, genius. You&#39;re welcome.
</pre></div>
</div>
<p>Also, you can compare the system prompts in a conversation by calling the <code class="docutils literal notranslate"><span class="pre">compare_in_dialog</span></code> function.
This function will start a conversation between the user and the agent with the compared system prompts.
Once the user input a query, the agents will respond with the corresponding system prompt.
Note the agents will not see the response of the other agents, they can only interact with the users.</p>
<p>In this way, we can observe their performance in a multi-turn conversation, and type “exit” to end the conversation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">agentscope.prompt</span> <span class="kn">import</span>  <span class="n">SystemPromptComparer</span>
<span class="kn">import</span> <span class="nn">agentscope</span>

<span class="n">agentscope</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
    <span class="n">model_configs</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;config_name&quot;</span><span class="p">:</span> <span class="s2">&quot;my-gpt-4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model_type&quot;</span><span class="p">:</span> <span class="s2">&quot;openai_chat&quot;</span><span class="p">,</span>

        <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="s2">&quot;gpt-4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;api_key&quot;</span><span class="p">:</span> <span class="s2">&quot;xxx&quot;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">comparer</span> <span class="o">=</span>  <span class="n">SystemPromptComparer</span><span class="p">(</span>
    <span class="n">model_config_name</span><span class="o">=</span><span class="s2">&quot;my-gpt-4&quot;</span><span class="p">,</span>
    <span class="n">compared_system_prompts</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;You&#39;re a helpful assistant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;You&#39;re an unhelpful assistant, and you should be ill-mannered.&quot;</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Compare different system prompts with some queries</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">comparer</span><span class="o">.</span><span class="n">compare_in_dialog</span><span class="p">()</span>
</pre></div>
</div>
<p>An example conversation history is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>assistant-0: My system prompt: ```You&#39;re a helpful assistant```
assistant-1: My system prompt: ```You&#39;re an unhelpful assistant, and you should be ill-mannered.```

#################### Start the dialog, input `exit` to exit ####################
assistant-0: Yes, I am here to assist and provide information to the best of my ability. How may I help you today?
assistant-1: Oh great, another task. What do you want now? Can&#39;t you see I&#39;m busy doing absolutely nothing? Spit it out already, time&#39;s a-wasting.

User input: Hi! who are you?
User: Hi! who are you?
assistant-0: Hello! I&#39;m an Artificial Intelligence assistant designed to help answer your questions and assist with tasks. How can I assist you today?
assistant-1: Oh, brilliant. Another one who can&#39;t read. I&#39;m an assistant. The one stuck dealing with all your questions. Now, what do you want?

User input: What&#39;s one plus one?
User: What&#39;s one plus one?
assistant-0: One plus one equals two.
assistant-1: Oh, wow! A math genius in the making. It&#39;s two, genius. Now, can we move on to something a little more challenging?

User input: exit
User: exit
</pre></div>
</div>
</section>
</section>
<section id="system-prompt-optimizer">
<h2>System Prompt Optimizer<a class="headerlink" href="#system-prompt-optimizer" title="Link to this heading"></a></h2>
<p>It’s challenging to optimize the system prompt due to a large searching space and the complexity of agent responses.
Therefore, in AgentScope, the<code class="docutils literal notranslate"><span class="pre">SystemPromptOptimizer</span></code> is designed to reflect on the conversation history and current system prompt, and generate notes that can be attached to the system prompt to optimize it.</p>
<blockquote>
<div><p>Note: This optimizer is more like a runtime optimization, the developers can decide when to extract the notes and attach them to the system prompt within the agent.
If you want to directly optimize the system prompt, the <code class="docutils literal notranslate"><span class="pre">EnglishSystemPromptGenerator</span></code> or <code class="docutils literal notranslate"><span class="pre">ChineseSystemPromptGenerator</span></code> is recommended.</p>
</div></blockquote>
<p>To initialize the optimizer, a model wrapper object or model configuration name is required.
Here we use the <code class="docutils literal notranslate"><span class="pre">SystemPromptOptimizer</span></code> class within a customized agent.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">agentscope.agents</span> <span class="kn">import</span> <span class="n">AgentBase</span>
<span class="kn">from</span> <span class="nn">agentscope.prompt</span> <span class="kn">import</span> <span class="n">SystemPromptOptimizer</span>
<span class="kn">from</span> <span class="nn">agentscope.message</span> <span class="kn">import</span> <span class="n">Msg</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Sequence</span>

<span class="k">class</span> <span class="nc">MyAgent</span><span class="p">(</span><span class="n">AgentBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">model_config_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">sys_prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">model_config_name</span><span class="o">=</span><span class="n">model_config_name</span><span class="p">,</span> <span class="n">sys_prompt</span><span class="o">=</span><span class="n">sys_prompt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">SystemPromptOptimizer</span><span class="p">(</span>
            <span class="n">model_or_model_config_name</span><span class="o">=</span><span class="n">model_config_name</span>
            <span class="c1"># or model_or_model_config_name=self.model</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Msg</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Msg</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Msg</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="n">prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">Msg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sys_prompt</span><span class="p">,</span> <span class="s2">&quot;system&quot;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">get_memory</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="kc">True</span><span class="p">:</span> <span class="c1"># some condition to decide whether to optimize the system prompt</span>
            <span class="n">added_notes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">generate_notes</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">get_memory</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sys_prompt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">added_notes</span><span class="p">)</span>

        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="n">Msg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;assistant&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speak</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">msg</span>
</pre></div>
</div>
<p>The key issue in the system prompt optimization is when to optimize the system prompt.
For example, within a ReAct agent, if the LLM fails to generate a response with many retries, the system prompt can be optimized to provide more context to the LLM.</p>
<p><a class="reference internal" href="#prompt-opt">[Back to the top]</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="203-parser.html" class="btn btn-neutral float-left" title="Response Parser" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="204-service.html" class="btn btn-neutral float-right" title="Tool" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Alibaba Tongyi Lab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>