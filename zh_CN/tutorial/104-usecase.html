<!-- layout.html -->
<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>创造您的第一个应用 &mdash; AgentScope  文档</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=c9484b72" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=7d86a446"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/translations.js?v=beaddf03"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="日志和WebUI" href="105-logging.html" />
    <link rel="prev" title="快速开始" href="103-example.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" > 

          
          
          <a href="../index.html" class="icon icon-home">
            AgentScope
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div> <!-- language_selector.html -->
<div class="language-selector">
    <a href="../../en/tutorial/104-usecase.html">English</a></li> |
    <a href="../../zh_CN/tutorial/104-usecase.html">中文</a></li>
</div> 
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">AgentScope 教程</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="quick_start.html">快速上手</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="101-agentscope.html">关于AgentScope</a></li>
<li class="toctree-l2"><a class="reference internal" href="102-installation.html">安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="103-example.html">快速开始</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">创造您的第一个应用</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">开始</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#api">第一步: 准备模型API和设定模型配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="#agent">第二步：定义每个智能体（Agent）的角色</a></li>
<li class="toctree-l4"><a class="reference internal" href="#agentscopeagents">第三步：初始化AgentScope和Agents</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">第四步：构建游戏逻辑</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">第五步：运行应用</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id6">下一步</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="105-logging.html">日志和WebUI</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="advance.html">进阶使用</a></li>
<li class="toctree-l1"><a class="reference internal" href="contribute.html">参与贡献</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AgentScope API 文档</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.html">agentscope</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.message.html">agentscope.message</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.models.html">agentscope.models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.agents.html">agentscope.agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.memory.html">agentscope.memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.parsers.html">agentscope.parsers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.exception.html">agentscope.exception</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.pipelines.html">agentscope.pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.service.html">agentscope.service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.rpc.html">agentscope.rpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.web.html">agentscope.web</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.prompt.html">agentscope.prompt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.utils.html">agentscope.utils</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AgentScope</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="quick_start.html">快速上手</a></li>
      <li class="breadcrumb-item active">创造您的第一个应用</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorial/104-usecase.md.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="usecase-zh">
<span id="id1"></span><h1>创造您的第一个应用<a class="headerlink" href="#usecase-zh" title="Link to this heading"></a></h1>
<img src="https://img.alicdn.com/imgextra/i3/O1CN01dFpOh82643mygUh2Z_!!6000000007607-2-tps-1024-1024.png" alt="img" style="zoom:25%;" />
<p>在介绍更多AgentScope的高阶内容前，我们先会给您展示如何利用AgentScope内置的功能，快速搭建一个狼人杀游戏模拟应用。</p>
<p><strong>狼人杀</strong>是一个广为人知的桌面游戏。游戏设定在一个虚拟世界的村庄里。村庄里有真正的村民、也有伪装成村民的狼人；每个参与者都在游戏中都有自己的角色。对于村民方而言，他们的胜利条件是在全灭之前找出并杀死所有的狼人；对于狼人方而言，胜利条件就是杀死所有的村民。狼人杀这样的游戏是一个很好的可以自动展示多个有不同目标的智能体之间如何互动。</p>
<p>话不多说，让我们开始通过狼人杀这个游戏，解锁AgentScope多智体的应用吧！</p>
<section id="id2">
<h2>开始<a class="headerlink" href="#id2" title="Link to this heading"></a></h2>
<p>首先，确保您已经正确安装和配置好AgentScope。除此之外，本节内容会涉及到<code class="docutils literal notranslate"><span class="pre">Model</span> <span class="pre">API</span></code>,  <code class="docutils literal notranslate"><span class="pre">Agent</span></code>, <code class="docutils literal notranslate"><span class="pre">Msg</span></code>和 <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code>这几个概念（详情可以参考<a class="reference internal" href="101-agentscope.html"><span class="doc std std-doc">关于AgentScope</span></a>）。以下是本节教程内容概览。</p>
<p><strong>提示</strong>：本教程中的所有配置和代码文件均可以在<code class="docutils literal notranslate"><span class="pre">examples/game_werewolf</span></code>中找到。</p>
<section id="api">
<h3>第一步: 准备模型API和设定模型配置<a class="headerlink" href="#api" title="Link to this heading"></a></h3>
<p>就像我们在上一节教程中展示的，您需要为了您选择的OpenAI chat API, FastChat, 或vllm 准备一个JSON样式的模型配置文件。更多细节和高阶用法，比如用POST API配置本地模型，可以参考<a class="reference internal" href="203-model.html"><span class="doc std std-doc">关于模型</span></a>。</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;config_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;gpt-4-temperature-0.0&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;model_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;openai_chat&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;model_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;gpt-4&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;api_key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;xxx&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;organization&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;xxx&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;generate_args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;temperature&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="agent">
<h3>第二步：定义每个智能体（Agent）的角色<a class="headerlink" href="#agent" title="Link to this heading"></a></h3>
<p>在狼人杀游戏中，不同智能体会扮演不同角色；不同角色的智能体也有不同的能力和目标。下面便是我们大概归纳</p>
<ul class="simple">
<li><p>普通村民：普通的村民，没有特殊能力，只是寻求生存到最后。</p></li>
<li><p>狼人：伪装成村民的掠夺者，目标是比村民活得更久并杀死村民们。</p></li>
<li><p>预言家：一位拥有每晚看到一名玩家真实身份能力的村民。</p></li>
<li><p>女巫：一位村民，每晚可以救活或毒杀一名玩家</p></li>
</ul>
<p>要实现你自己的agent，你需要继承AgentBase并实现reply函数，当通过agent1(x)调用agent实例时，将执行此函数。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">agentscope.agents</span> <span class="kn">import</span> <span class="n">AgentBase</span>

<span class="k">class</span> <span class="nc">MyAgent</span><span class="p">(</span><span class="n">AgentBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># Do something here</span>
        <span class="o">...</span>
        <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
<p>AgentScope提供了几种开箱即用的agent实现，作为一个agent样例池。在这个应用程序中，我们使用一个内置agent，DictDialogAgent。这里我们给出一个将玩家分配为狼人角色的DictDialogAgent的示例配置：</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;class&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DictDialogAgent&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Player1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;sys_prompt&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Act as a player in a werewolf game. You are Player1 and\nthere are totally 6 players, named Player1, Player2, Player3, Player4, Player5 and Player6.\n\nPLAYER ROLES:\nIn werewolf game, players are divided into two werewolves, two villagers, one seer, and one witch. Note only werewolves know who are their teammates.\nWerewolves: They know their teammates&#39; identities and attempt to eliminate a villager each night while trying to remain undetected.\nVillagers: They do not know who the werewolves are and must work together during the day to deduce who the werewolves might be and vote to eliminate them.\nSeer: A villager with the ability to learn the true identity of one player each night. This role is crucial for the villagers to gain information.\nWitch: A character who has a one-time ability to save a player from being eliminated at night (sometimes this is a potion of life) and a one-time ability to eliminate a player at night (a potion of death).\n\nGAME RULE:\nThe game consists of two phases: night phase and day phase. The two phases are repeated until werewolf or villager wins the game.\n1. Night Phase: During the night, the werewolves discuss and vote for a player to eliminate. Special roles also perform their actions at this time (e.g., the Seer chooses a player to learn their role, the witch chooses a decide if save the player).\n2. Day Phase: During the day, all surviving players discuss who they suspect might be a werewolf. No one reveals their role unless it serves a strategic purpose. After the discussion, a vote is taken, and the player with the most votes is \&quot;lynched\&quot; or eliminated from the game.\n\nVICTORY CONDITION:\nFor werewolves, they win the game if the number of werewolves is equal to or greater than the number of remaining villagers.\nFor villagers, they win if they identify and eliminate all of the werewolves in the group.\n\nCONSTRAINTS:\n1. Your response should be in the first person.\n2. This is a conversational game. You should respond only based on the conversation history and your strategy.\n\nYou are playing werewolf in this game.\n&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;model_config_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;gpt-3.5-turbo&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;use_memory&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>在这个配置中，Player1被指定为一个DictDialogAgent。参数包括一个系统提示（sys_prompt），它可以指导agent的行为；一个模型配置名（model_config_name），它决定了模型配置的名称；以及一个标志（use_memory），指示agent是否应该记住过去的互动。</p>
<p>对于其他玩家，大家可以根据他们的角色进行定制。每个角色可能有不同的提示、模型或记忆设置。你可以参考位于AgentScope示例目录下的<code class="docutils literal notranslate"><span class="pre">examples/game_werewolf/configs/agent_configs.json</span></code>文件。</p>
</section>
<section id="agentscopeagents">
<h3>第三步：初始化AgentScope和Agents<a class="headerlink" href="#agentscopeagents" title="Link to this heading"></a></h3>
<p>现在我们已经定义了角色，我们可以初始化AgentScope环境和所有agents。这个过程通过AgentScope的几行代码和我们准备的配置文件（假设有2个狼人、2个村民、1个女巫和1个预言家）就能简单完成：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">agentscope</span>

<span class="c1"># read model and agent configs, and initialize agents automatically</span>
<span class="n">survivors</span> <span class="o">=</span> <span class="n">agentscope</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
    <span class="n">model_configs</span><span class="o">=</span><span class="s2">&quot;./configs/model_configs.json&quot;</span><span class="p">,</span>
    <span class="n">agent_configs</span><span class="o">=</span><span class="s2">&quot;./configs/agent_configs.json&quot;</span><span class="p">,</span>
    <span class="n">logger_level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Define the roles within the game. This list should match the order and number</span>
<span class="c1"># of agents specified in the &#39;agent_configs.json&#39; file.</span>
<span class="n">roles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;werewolf&quot;</span><span class="p">,</span> <span class="s2">&quot;werewolf&quot;</span><span class="p">,</span> <span class="s2">&quot;villager&quot;</span><span class="p">,</span> <span class="s2">&quot;villager&quot;</span><span class="p">,</span> <span class="s2">&quot;seer&quot;</span><span class="p">,</span> <span class="s2">&quot;witch&quot;</span><span class="p">]</span>

<span class="c1"># Based on their roles, assign the initialized agents to variables.</span>
<span class="c1"># This helps us reference them easily in the game logic.</span>
<span class="n">wolves</span><span class="p">,</span> <span class="n">villagers</span><span class="p">,</span> <span class="n">witch</span><span class="p">,</span> <span class="n">seer</span> <span class="o">=</span> <span class="n">survivors</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">survivors</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">survivors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">survivors</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
<p>上面这段代码中，我们为我们的agent分配了角色，并将它们与决定它们行为的配置相关联。</p>
</section>
<section id="id3">
<h3>第四步：构建游戏逻辑<a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<p>在这一步中，你将使用AgentScope的辅助工具设置游戏逻辑，并组织狼人游戏的流程。</p>
<section id="pipeline-msghub">
<h4>使用 Pipeline 和 MsgHub<a class="headerlink" href="#pipeline-msghub" title="Link to this heading"></a></h4>
<p>为了简化agent通信的构建，AgentScope提供了两个有用的概念：Pipeline和MsgHub。</p>
<ul>
<li><p><strong>Pipeline</strong>：它能让用户轻松地编程实现agent之间的不同通信编排。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">agentscope.pipelines</span> <span class="kn">import</span> <span class="n">SequentialPipeline</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">SequentialPipeline</span><span class="p">(</span><span class="n">agent1</span><span class="p">,</span> <span class="n">agent2</span><span class="p">,</span> <span class="n">agent3</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">pipe</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># the message x will be passed and replied by agent 1,2,3 in order</span>
</pre></div>
</div>
</li>
<li><p><strong>MsgHub</strong>：你可能已经注意到，上述所有例子都是一对一通信。为了实现群聊，我们提供了另一个通信辅助工具msghub。有了它，参与者的消息将自动广播给所有其他参与者。在这种情况下，参与agent甚至不需要输入和输出消息。我们需要做的只是决定发言的顺序。此外，msghub还支持参与者的动态控制。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">msghub</span><span class="p">(</span><span class="n">participants</span><span class="o">=</span><span class="p">[</span><span class="n">agent1</span><span class="p">,</span> <span class="n">agent2</span><span class="p">,</span> <span class="n">agent3</span><span class="p">])</span> <span class="k">as</span> <span class="n">hub</span><span class="p">:</span>
    <span class="n">agent1</span><span class="p">()</span>
    <span class="n">agent2</span><span class="p">()</span>

    <span class="c1"># Broadcast a message to all participants</span>
    <span class="n">hub</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="n">Msg</span><span class="p">(</span><span class="s2">&quot;Host&quot;</span><span class="p">,</span> <span class="s2">&quot;Welcome to join the group chat!&quot;</span><span class="p">))</span>

    <span class="c1"># Add or delete participants dynamically</span>
    <span class="n">hub</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">agent1</span><span class="p">)</span>
    <span class="n">hub</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">agent4</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id4">
<h4>实现狼人杀的游戏流程<a class="headerlink" href="#id4" title="Link to this heading"></a></h4>
<p>游戏逻辑分为两个主要阶段：(1)夜晚，狼人行动；以及(2)白天，所有玩家讨论和投票。每个阶段都将通过使用pipelines来管理多agent通信的代码部分来处理。</p>
<ul class="simple">
<li><p><strong>1.1 夜晚阶段：狼人讨论和投票</strong></p></li>
</ul>
<p>在夜晚阶段，狼人必须相互讨论以决定一个要杀死的目标。msghub函数为狼人之间的通信创建了一个消息中心，其中每个agent发送的消息都能被msghub内的所有其他agent观察到。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># start the game</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">MAX_GAME_ROUND</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="c1"># Night phase: werewolves discuss</span>
    <span class="n">hint</span> <span class="o">=</span> <span class="n">HostMsg</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">Prompts</span><span class="o">.</span><span class="n">to_wolves</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n2s</span><span class="p">(</span><span class="n">wolves</span><span class="p">)))</span>
    <span class="k">with</span> <span class="n">msghub</span><span class="p">(</span><span class="n">wolves</span><span class="p">,</span> <span class="n">announcement</span><span class="o">=</span><span class="n">hint</span><span class="p">)</span> <span class="k">as</span> <span class="n">hub</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MAX_WEREWOLF_DISCUSSION_ROUND</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">sequentialpipeline</span><span class="p">(</span><span class="n">wolves</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">agreement</span><span class="p">:</span>
                <span class="k">break</span>
</pre></div>
</div>
<p>讨论结束后，根据少数服从多数，狼人进行投票选出他们的目标。然后，投票的结果将广播给所有狼人。</p>
<p>注意：具体的提示和实用函数可以在<code class="docutils literal notranslate"><span class="pre">examples/game_werewolf</span></code>中找到。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="c1"># werewolves vote</span>
        <span class="n">hint</span> <span class="o">=</span> <span class="n">HostMsg</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">Prompts</span><span class="o">.</span><span class="n">to_wolves_vote</span><span class="p">)</span>
        <span class="n">votes</span> <span class="o">=</span> <span class="p">[</span><span class="n">extract_name_and_id</span><span class="p">(</span><span class="n">wolf</span><span class="p">(</span><span class="n">hint</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">wolf</span> <span class="ow">in</span> <span class="n">wolves</span><span class="p">]</span>
        <span class="c1"># broadcast the result to werewolves</span>
        <span class="n">dead_player</span> <span class="o">=</span> <span class="p">[</span><span class="n">majority_vote</span><span class="p">(</span><span class="n">votes</span><span class="p">)]</span>
        <span class="n">hub</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span>
            <span class="n">HostMsg</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">Prompts</span><span class="o">.</span><span class="n">to_wolves_res</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dead_player</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
        <span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>1.2 女巫的回合</strong></p></li>
</ul>
<p>如果女巫还活着，她就有机会使用她的力量：救被狼人选中的（被杀的）玩家，或使用她的毒药去杀一位玩家。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># Witch&#39;s turn</span>
    <span class="n">healing_used_tonight</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">witch</span> <span class="ow">in</span> <span class="n">survivors</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">healing</span><span class="p">:</span>
            <span class="c1"># Witch decides whether to use the healing potion</span>
            <span class="n">hint</span> <span class="o">=</span> <span class="n">HostMsg</span><span class="p">(</span>
                <span class="n">content</span><span class="o">=</span><span class="n">Prompts</span><span class="o">.</span><span class="n">to_witch_resurrect</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span>
                    <span class="p">{</span><span class="s2">&quot;witch_name&quot;</span><span class="p">:</span> <span class="n">witch</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;dead_name&quot;</span><span class="p">:</span> <span class="n">dead_player</span><span class="p">[</span><span class="mi">0</span><span class="p">]},</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="c1"># Witch decides whether to use the poison</span>
            <span class="k">if</span> <span class="n">witch</span><span class="p">(</span><span class="n">hint</span><span class="p">)</span><span class="o">.</span><span class="n">resurrect</span><span class="p">:</span>
                <span class="n">healing_used_tonight</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">dead_player</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">healing</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>1.3 预言家的回合</strong></p></li>
</ul>
<p>预言家有机会揭示一名玩家的真实身份。这信息对于村民方来说可能至关重要。<code class="docutils literal notranslate"><span class="pre">observe()</span></code>函数允许每个agent注意到一个消息，而不需要立即产生回复。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># Seer&#39;s turn</span>
    <span class="k">if</span> <span class="n">seer</span> <span class="ow">in</span> <span class="n">survivors</span><span class="p">:</span>
        <span class="c1"># Seer chooses a player to reveal their identity</span>
        <span class="n">hint</span> <span class="o">=</span> <span class="n">HostMsg</span><span class="p">(</span>
            <span class="n">content</span><span class="o">=</span><span class="n">Prompts</span><span class="o">.</span><span class="n">to_seer</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">seer</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">n2s</span><span class="p">(</span><span class="n">survivors</span><span class="p">)),</span>
        <span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">seer</span><span class="p">(</span><span class="n">hint</span><span class="p">)</span>

        <span class="n">player</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">extract_name_and_id</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="n">role</span> <span class="o">=</span> <span class="s2">&quot;werewolf&quot;</span> <span class="k">if</span> <span class="n">roles</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;werewolf&quot;</span> <span class="k">else</span> <span class="s2">&quot;villager&quot;</span>
        <span class="n">hint</span> <span class="o">=</span> <span class="n">HostMsg</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">Prompts</span><span class="o">.</span><span class="n">to_seer_result</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">role</span><span class="p">))</span>
        <span class="n">seer</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">hint</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>1.4 更新存活玩家</strong></p></li>
</ul>
<p>根据夜间采取的行动，程序需要更新幸存玩家的列表。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># Update the list of survivors and werewolves after the night&#39;s events</span>
    <span class="n">survivors</span><span class="p">,</span> <span class="n">wolves</span> <span class="o">=</span> <span class="n">update_alive_players</span><span class="p">(</span><span class="n">survivors</span><span class="p">,</span> <span class="n">wolves</span><span class="p">,</span> <span class="n">dead_player</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>2.1 白天阶段：讨论和投票</strong></p></li>
</ul>
<p>在白天，所有存活玩家将讨论然后投票以淘汰一名疑似狼人的玩家。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># Daytime discussion</span>
    <span class="k">with</span> <span class="n">msghub</span><span class="p">(</span><span class="n">survivors</span><span class="p">,</span> <span class="n">announcement</span><span class="o">=</span><span class="n">hints</span><span class="p">)</span> <span class="k">as</span> <span class="n">hub</span><span class="p">:</span>
        <span class="c1"># Discuss</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">sequentialpipeline</span><span class="p">(</span><span class="n">survivors</span><span class="p">)</span>
        <span class="c1"># Vote</span>
        <span class="n">hint</span> <span class="o">=</span> <span class="n">HostMsg</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">Prompts</span><span class="o">.</span><span class="n">to_all_vote</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n2s</span><span class="p">(</span><span class="n">survivors</span><span class="p">)))</span>
        <span class="n">votes</span> <span class="o">=</span> <span class="p">[</span><span class="n">extract_name_and_id</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="n">hint</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">survivors</span><span class="p">]</span>
        <span class="n">vote_res</span> <span class="o">=</span> <span class="n">majority_vote</span><span class="p">(</span><span class="n">votes</span><span class="p">)</span>
        <span class="c1"># Broadcast the voting result to all players</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">HostMsg</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">Prompts</span><span class="o">.</span><span class="n">to_all_res</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vote_res</span><span class="p">))</span>
        <span class="n">hub</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="c1"># Update the list of survivors and werewolves after the vote</span>
        <span class="n">survivors</span><span class="p">,</span> <span class="n">wolves</span> <span class="o">=</span> <span class="n">update_alive_players</span><span class="p">(</span><span class="n">survivors</span><span class="p">,</span> <span class="n">wolves</span><span class="p">,</span> <span class="n">vote_res</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>2.2 检查胜利条件</strong></p></li>
</ul>
<p>每个阶段结束后，游戏会检查是狼人还是村民获胜。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="c1"># Check if either side has won</span>
        <span class="k">if</span> <span class="n">check_winning</span><span class="p">(</span><span class="n">survivors</span><span class="p">,</span> <span class="n">wolves</span><span class="p">,</span> <span class="s2">&quot;Moderator&quot;</span><span class="p">):</span>
            <span class="k">break</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>2.3 继续到下一轮</strong></p></li>
</ul>
<p>如果狼人和村民都没有获胜，游戏将继续到下一轮。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="c1"># If the game hasn&#39;t ended, prepare for the next round</span>
        <span class="n">hub</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="n">HostMsg</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">Prompts</span><span class="o">.</span><span class="n">to_all_continue</span><span class="p">))</span>
</pre></div>
</div>
<p>这些代码块展现了使用AgentScope的<code class="docutils literal notranslate"><span class="pre">msghub</span></code>和<code class="docutils literal notranslate"><span class="pre">pipeline</span></code>的狼人游戏的核心游戏循环，这些工具有助于轻松管理应用程序的操作逻辑。</p>
</section>
</section>
<section id="id5">
<h3>第五步：运行应用<a class="headerlink" href="#id5" title="Link to this heading"></a></h3>
<p>完成了以上游戏逻辑和agent的设置，你已经可以运行狼人游戏了。通过执行<code class="docutils literal notranslate"><span class="pre">pipeline</span></code>，游戏将按预定义的阶段进行，agents
基于它们的角色和上述编码的策略进行互动：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>examples/game_werewolf
python<span class="w"> </span>main.py<span class="w">  </span><span class="c1"># Assuming the pipeline is implemented in main.py</span>
</pre></div>
</div>
<p>游戏开始后，你将在终端看到类似于下面的日志输出。这些日志展示了游戏是如何展开的：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Moderator:<span class="w"> </span>Player1<span class="w"> </span>and<span class="w"> </span>Player2,<span class="w"> </span>you<span class="w"> </span>are<span class="w"> </span>werewolves.<span class="w"> </span>If<span class="w"> </span>you<span class="w"> </span>are<span class="w"> </span>alone,<span class="w"> </span>eliminate<span class="w"> </span>a<span class="w"> </span>player,<span class="w"> </span><span class="k">else</span><span class="w"> </span>discuss<span class="w"> </span>with<span class="w"> </span>your<span class="w"> </span>teammates<span class="w"> </span>and<span class="w"> </span>reach<span class="w"> </span>an<span class="w"> </span>agreement.<span class="w"> </span>Response<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span>format<span class="w"> </span>which<span class="w"> </span>can<span class="w"> </span>be<span class="w"> </span>loaded<span class="w"> </span>by<span class="w">  </span>json.loads<span class="o">(){</span>
<span class="w">    </span><span class="s2">&quot;thought&quot;</span>:<span class="w"> </span><span class="s2">&quot;thought&quot;</span>,
<span class="w">    </span><span class="s2">&quot;speak&quot;</span>:<span class="w"> </span><span class="s2">&quot;thoughts summary to say to others&quot;</span>,
<span class="w">    </span><span class="s2">&quot;agreement&quot;</span>:<span class="w"> </span><span class="s2">&quot;whether the discussion reached an agreement or not(true/false)&quot;</span>
<span class="o">}</span>
Player1:<span class="w"> </span>Player2,<span class="w"> </span>let<span class="s1">&#39;s discuss who we should eliminate tonight.</span>
<span class="s1">Player2: I think we should eliminate Player4 tonight. They seem suspicious to me.</span>
<span class="s1">Player1: I think we should eliminate Player4 tonight. They seem suspicious to me.</span>
<span class="s1">Player2: I agree with Player2, let&#39;</span>s<span class="w"> </span>eliminate<span class="w"> </span>Player4<span class="w"> </span>tonight.<span class="w"> </span>They<span class="w"> </span>seem<span class="w"> </span>suspicious.
Moderator:<span class="w"> </span>Which<span class="w"> </span>player<span class="w"> </span><span class="k">do</span><span class="w"> </span>you<span class="w"> </span>vote<span class="w"> </span>to<span class="w"> </span>kill?<span class="w"> </span>Response<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span>format<span class="w"> </span>which<span class="w"> </span>can<span class="w"> </span>be<span class="w"> </span>loaded<span class="w"> </span>by<span class="w"> </span>python<span class="w"> </span>json.loads<span class="o">()</span>
<span class="o">{{</span>
<span class="w">   </span><span class="s2">&quot;thought&quot;</span>:<span class="w"> </span><span class="s2">&quot;thought&quot;</span><span class="w"> </span>,
<span class="w">   </span><span class="s2">&quot;speak&quot;</span>:<span class="w"> </span><span class="s2">&quot;player_name&quot;</span>
<span class="o">}}</span>
Player1:<span class="w"> </span>Player4
Player2:<span class="w"> </span>Player4
Moderator:<span class="w"> </span>The<span class="w"> </span>player<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>most<span class="w"> </span>votes<span class="w"> </span>is<span class="w"> </span>Player4.
Moderator:<span class="w"> </span>Player6,<span class="w"> </span>you<span class="s1">&#39;re witch. Tonight Player4 is eliminated. Would you like to resurrect Player4? Response in the following format which can be loaded by python json.loads()</span>
<span class="s1">{</span>
<span class="s1">    &quot;thought&quot;: &quot;thought&quot;,</span>
<span class="s1">    &quot;speak&quot;: &quot;thoughts summary to say&quot;,</span>
<span class="s1">    &quot;resurrect&quot;: &quot;true/false&quot;</span>
<span class="s1">}</span>
<span class="s1">Player6: I have considered the options, and I choose to resurrect Player4.</span>
<span class="s1">Moderator: Player5, you&#39;</span>re<span class="w"> </span>seer.<span class="w"> </span>Which<span class="w"> </span>player<span class="w"> </span><span class="k">in</span><span class="w"> </span>Player1,<span class="w"> </span>Player2,<span class="w"> </span>Player3,<span class="w"> </span>Player4,<span class="w"> </span>Player5<span class="w"> </span>and<span class="w"> </span>Player6<span class="w"> </span>would<span class="w"> </span>you<span class="w"> </span>like<span class="w"> </span>to<span class="w"> </span>check<span class="w"> </span>tonight?<span class="w"> </span>Response<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span>json<span class="w"> </span>format<span class="w"> </span>which<span class="w"> </span>can<span class="w"> </span>be<span class="w"> </span>loaded<span class="w"> </span>by<span class="w"> </span>python<span class="w"> </span>json.loads<span class="o">()</span>
<span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;thought&quot;</span>:<span class="w"> </span><span class="s2">&quot;thought&quot;</span><span class="w"> </span>,
<span class="w">    </span><span class="s2">&quot;speak&quot;</span>:<span class="w"> </span><span class="s2">&quot;player_name&quot;</span>
<span class="o">}</span>
Player5:<span class="w"> </span>Player3
Moderator:<span class="w"> </span>Okay,<span class="w"> </span>the<span class="w"> </span>role<span class="w"> </span>of<span class="w"> </span>Player3<span class="w"> </span>is<span class="w"> </span>villager.
Moderator:<span class="w"> </span>The<span class="w"> </span>day<span class="w"> </span>is<span class="w"> </span>coming,<span class="w"> </span>all<span class="w"> </span>the<span class="w"> </span>players<span class="w"> </span>open<span class="w"> </span>your<span class="w"> </span>eyes.<span class="w"> </span>Last<span class="w"> </span>night<span class="w"> </span>is<span class="w"> </span>peaceful,<span class="w"> </span>no<span class="w"> </span>player<span class="w"> </span>is<span class="w"> </span>eliminated.
...
</pre></div>
</div>
</section>
</section>
<section id="id6">
<h2>下一步<a class="headerlink" href="#id6" title="Link to this heading"></a></h2>
<p>现在你已经掌握了如何使用AgentScope方便地设置多agent应用程序。您可以随意修改游戏，包括引入额外的角色或者引入更复杂的策略。如果你想更深入地探索AgentScope的更多功能，比如agent使用的内存管理和服务函数，请参考高级探索部分的教程并查阅API参考。</p>
<p><a class="reference internal" href="#usecase-zh">[返回顶部]</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="103-example.html" class="btn btn-neutral float-left" title="快速开始" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="105-logging.html" class="btn btn-neutral float-right" title="日志和WebUI" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2024, Alibaba Tongyi Lab。</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>