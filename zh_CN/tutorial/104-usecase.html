<!-- layout.html -->
<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>样例：狼人杀游戏 &mdash; AgentScope  文档</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=c9484b72" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=7d86a446"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/translations.js?v=beaddf03"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="参与贡献" href="contribute.html" />
    <link rel="prev" title="监控" href="207-monitor.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" > 

          
          
          <a href="../index.html" class="icon icon-home">
            AgentScope
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div> <!-- language_selector.html -->
<div class="language-selector">
    <a href="../../en/tutorial/104-usecase.html">English</a></li> |
    <a href="../../zh_CN/tutorial/104-usecase.html">中文</a></li>
</div> 
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">AgentScope 教程</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="101-agentscope.html">关于AgentScope</a></li>
<li class="toctree-l1"><a class="reference internal" href="102-installation.html">安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="103-example.html">快速开始</a></li>
<li class="toctree-l1"><a class="reference internal" href="203-model.html">模型</a></li>
<li class="toctree-l1"><a class="reference internal" href="203-stream.html">流式输出</a></li>
<li class="toctree-l1"><a class="reference internal" href="206-prompt.html">提示工程</a></li>
<li class="toctree-l1"><a class="reference internal" href="201-agent.html">Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="205-memory.html">记忆</a></li>
<li class="toctree-l1"><a class="reference internal" href="203-parser.html">结果解析</a></li>
<li class="toctree-l1"><a class="reference internal" href="209-prompt_opt.html">系统提示优化</a></li>
<li class="toctree-l1"><a class="reference internal" href="204-service.html">工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="202-pipeline.html">Pipeline和MsgHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="208-distribute.html">分布式</a></li>
<li class="toctree-l1"><a class="reference internal" href="209-gui.html">AgentScope Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="210-rag.html">简要介绍AgentScope中的RAG</a></li>
<li class="toctree-l1"><a class="reference internal" href="105-logging.html">日志</a></li>
<li class="toctree-l1"><a class="reference internal" href="207-monitor.html">监控</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">样例：狼人杀游戏</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id2">开始</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#api">第一步: 准备模型API和设定模型配置</a></li>
<li class="toctree-l3"><a class="reference internal" href="#agent">第二步：定义每个智能体（Agent）的角色</a></li>
<li class="toctree-l3"><a class="reference internal" href="#agentscopeagents">第三步：初始化AgentScope和Agents</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">第四步：构建游戏逻辑</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#parser">使用 Parser</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pipeline-msghub">使用 Pipeline 和 MsgHub</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">实现狼人杀的游戏流程</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id5">第五步：运行应用</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contribute.html">参与贡献</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AgentScope API 文档</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.html">agentscope package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.message.html">agentscope.message package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.models.html">agentscope.models package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.agents.html">agentscope.agents package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.memory.html">agentscope.memory package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.parsers.html">agentscope.parsers package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.exception.html">agentscope.exception module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.pipelines.html">agentscope.pipelines package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.service.html">agentscope.service package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.rpc.html">agentscope.rpc package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.server.html">agentscope.server package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.web.html">agentscope.web package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.prompt.html">agentscope.prompt package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agentscope.utils.html">agentscope.utils package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AgentScope</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">样例：狼人杀游戏</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorial/104-usecase.md.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="usecase-zh">
<span id="id1"></span><h1>样例：狼人杀游戏<a class="headerlink" href="#usecase-zh" title="Link to this heading"></a></h1>
<img src="https://img.alicdn.com/imgextra/i3/O1CN01dFpOh82643mygUh2Z_!!6000000007607-2-tps-1024-1024.png" alt="img" style="zoom:25%;" />
<p><strong>狼人杀</strong>是非常具有代表性的，具有复杂SOP流程的游戏。游戏中，玩家分别扮演狼人和村民的角色进行对抗，其中一些村民（例如预言家和女巫）还有特殊的技能。当狼人被全部杀死后村民取得胜利；而当狼人的数量等于村民的数量时即狼人获得胜利。
我们将利用 AgentScope 构建一个狼人杀游戏，用 Agent 来扮演不同的角色进行互动，并推动游戏的进行。</p>
<p>完整的样例代码可以在GitHub仓库的<a class="reference external" href="https://github.com/modelscope/agentscope/tree/main/examples/game_werewolf">examples/game_werewolf</a>找到，这里我们将介绍构建狼人杀游戏中的几个关键步骤。</p>
<section id="id2">
<h2>开始<a class="headerlink" href="#id2" title="Link to this heading"></a></h2>
<p>首先，确保您已经正确安装和配置好AgentScope。除此之外，本节内容会涉及到<code class="docutils literal notranslate"><span class="pre">Model</span> <span class="pre">API</span></code>,  <code class="docutils literal notranslate"><span class="pre">Agent</span></code>, <code class="docutils literal notranslate"><span class="pre">Msg</span></code>和<code class="docutils literal notranslate"><span class="pre">Pipeline</span></code>这几个概念（详情可以参考<a class="reference internal" href="101-agentscope.html"><span class="std std-doc">关于AgentScope</span></a>）。以下是本节教程内容概览。</p>
<p><strong>提示</strong>：本教程中的所有配置和代码文件均可以在<code class="docutils literal notranslate"><span class="pre">examples/game_werewolf</span></code>中找到。</p>
<section id="api">
<h3>第一步: 准备模型API和设定模型配置<a class="headerlink" href="#api" title="Link to this heading"></a></h3>
<p>就像我们在上一节教程中展示的，您需要为了您选择的OpenAI chat API, FastChat, 或vllm准备一个JSON样式的模型配置文件。更多细节和高阶用法，比如用POST API配置本地模型，可以参考<a class="reference internal" href="203-model.html"><span class="std std-doc">关于模型</span></a>。</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;config_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;gpt-4-temperature-0.0&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;model_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;openai_chat&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;model_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;gpt-4&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;api_key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;xxx&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;organization&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;xxx&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;generate_args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;temperature&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="agent">
<h3>第二步：定义每个智能体（Agent）的角色<a class="headerlink" href="#agent" title="Link to this heading"></a></h3>
<p>在狼人杀游戏中，不同智能体会扮演不同角色；不同角色的智能体也有不同的能力和目标。下面便是我们大概归纳</p>
<ul class="simple">
<li><p>普通村民：普通的村民，没有特殊能力，只是寻求生存到最后。</p></li>
<li><p>狼人：伪装成村民的掠夺者，目标是比村民活得更久并杀死村民们。</p></li>
<li><p>预言家：一位拥有每晚看到一名玩家真实身份能力的村民。</p></li>
<li><p>女巫：一位村民，每晚可以救活或毒杀一名玩家</p></li>
</ul>
<p>要实现您自己的agent，您需要继承AgentBase并实现reply函数，当通过agent1(x)调用agent实例时，将执行此函数。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">agentscope.agents</span> <span class="kn">import</span> <span class="n">AgentBase</span>
<span class="kn">from</span> <span class="nn">agentscope.message</span> <span class="kn">import</span> <span class="n">Msg</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Sequence</span>


<span class="k">class</span> <span class="nc">MyAgent</span><span class="p">(</span><span class="n">AgentBase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Msg</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Msg</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Msg</span><span class="p">:</span>
        <span class="c1"># Do something here</span>
        <span class="o">...</span>
        <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
<p>AgentScope提供了几种开箱即用的agent实现，作为一个agent样例池。在这个应用程序中，我们使用一个内置agent，DictDialogAgent。这里我们给出一个将玩家分配为狼人角色的DictDialogAgent的示例配置：</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;class&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DictDialogAgent&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Player1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;sys_prompt&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Act as a player in a werewolf game. You are Player1 and\nthere are totally 6 players, named Player1, Player2, Player3, Player4, Player5 and Player6.\n\nPLAYER ROLES:\nIn werewolf game, players are divided into two werewolves, two villagers, one seer, and one witch. Note only werewolves know who are their teammates.\nWerewolves: They know their teammates&#39; identities and attempt to eliminate a villager each night while trying to remain undetected.\nVillagers: They do not know who the werewolves are and must work together during the day to deduce who the werewolves might be and vote to eliminate them.\nSeer: A villager with the ability to learn the true identity of one player each night. This role is crucial for the villagers to gain information.\nWitch: A character who has a one-time ability to save a player from being eliminated at night (sometimes this is a potion of life) and a one-time ability to eliminate a player at night (a potion of death).\n\nGAME RULE:\nThe game consists of two phases: night phase and day phase. The two phases are repeated until werewolf or villager wins the game.\n1. Night Phase: During the night, the werewolves discuss and vote for a player to eliminate. Special roles also perform their actions at this time (e.g., the Seer chooses a player to learn their role, the witch chooses a decide if save the player).\n2. Day Phase: During the day, all surviving players discuss who they suspect might be a werewolf. No one reveals their role unless it serves a strategic purpose. After the discussion, a vote is taken, and the player with the most votes is \&quot;lynched\&quot; or eliminated from the game.\n\nVICTORY CONDITION:\nFor werewolves, they win the game if the number of werewolves is equal to or greater than the number of remaining villagers.\nFor villagers, they win if they identify and eliminate all of the werewolves in the group.\n\nCONSTRAINTS:\n1. Your response should be in the first person.\n2. This is a conversational game. You should respond only based on the conversation history and your strategy.\n\nYou are playing werewolf in this game.\n&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;model_config_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;gpt-3.5-turbo&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;use_memory&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>在这个配置中，Player1被指定为一个DictDialogAgent。参数包括一个系统提示（sys_prompt），它可以指导agent的行为；一个模型配置名（model_config_name），它决定了模型配置的名称；以及一个标志（use_memory），指示agent是否应该记住过去的互动。</p>
<p>对于其他玩家，大家可以根据他们的角色进行定制。每个角色可能有不同的提示、模型或记忆设置。您可以参考位于AgentScope示例目录下的<code class="docutils literal notranslate"><span class="pre">examples/game_werewolf/configs/agent_configs.json</span></code>文件。</p>
</section>
<section id="agentscopeagents">
<h3>第三步：初始化AgentScope和Agents<a class="headerlink" href="#agentscopeagents" title="Link to this heading"></a></h3>
<p>现在我们已经定义了角色，我们可以初始化AgentScope环境和所有agents。这个过程通过AgentScope的几行代码和我们准备的配置文件（假设有2个狼人、2个村民、1个女巫和1个预言家）就能简单完成：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">agentscope</span>

<span class="c1"># read model and agent configs, and initialize agents automatically</span>
<span class="n">survivors</span> <span class="o">=</span> <span class="n">agentscope</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
    <span class="n">model_configs</span><span class="o">=</span><span class="s2">&quot;./configs/model_configs.json&quot;</span><span class="p">,</span>
    <span class="n">agent_configs</span><span class="o">=</span><span class="s2">&quot;./configs/agent_configs.json&quot;</span><span class="p">,</span>
    <span class="n">logger_level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Define the roles within the game. This list should match the order and number</span>
<span class="c1"># of agents specified in the &#39;agent_configs.json&#39; file.</span>
<span class="n">roles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;werewolf&quot;</span><span class="p">,</span> <span class="s2">&quot;werewolf&quot;</span><span class="p">,</span> <span class="s2">&quot;villager&quot;</span><span class="p">,</span> <span class="s2">&quot;villager&quot;</span><span class="p">,</span> <span class="s2">&quot;seer&quot;</span><span class="p">,</span> <span class="s2">&quot;witch&quot;</span><span class="p">]</span>

<span class="c1"># Based on their roles, assign the initialized agents to variables.</span>
<span class="c1"># This helps us reference them easily in the game logic.</span>
<span class="n">wolves</span><span class="p">,</span> <span class="n">villagers</span><span class="p">,</span> <span class="n">witch</span><span class="p">,</span> <span class="n">seer</span> <span class="o">=</span> <span class="n">survivors</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">survivors</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">survivors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">survivors</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
<p>上面这段代码中，我们为我们的agent分配了角色，并将它们与决定它们行为的配置相关联。</p>
</section>
<section id="id3">
<h3>第四步：构建游戏逻辑<a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<p>在这一步中，您将使用AgentScope的辅助工具设置游戏逻辑，并组织狼人游戏的流程。</p>
<section id="parser">
<h4>使用 Parser<a class="headerlink" href="#parser" title="Link to this heading"></a></h4>
<p>为了能让 <code class="docutils literal notranslate"><span class="pre">DictDialogAgent</span></code> 能够按照用户定制化的字段进行输出，以及增加大模型解析不同字段内容的成功率，我们新增了 <code class="docutils literal notranslate"><span class="pre">parser</span></code>
模块。下面是一个 <code class="docutils literal notranslate"><span class="pre">parser</span></code> 例子的配置：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">to_wolves_vote</span> <span class="o">=</span> <span class="s2">&quot;Which player do you vote to kill?&quot;</span>

<span class="n">wolves_vote_parser</span> <span class="o">=</span> <span class="n">MarkdownJsonDictParser</span><span class="p">(</span>
    <span class="n">content_hint</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;thought&quot;</span><span class="p">:</span> <span class="s2">&quot;what you thought&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vote&quot;</span><span class="p">:</span> <span class="s2">&quot;player_name&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">required_keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;thought&quot;</span><span class="p">,</span> <span class="s2">&quot;vote&quot;</span><span class="p">],</span>
    <span class="n">keys_to_memory</span><span class="o">=</span><span class="s2">&quot;vote&quot;</span><span class="p">,</span>
    <span class="n">keys_to_content</span><span class="o">=</span><span class="s2">&quot;vote&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>关于 <code class="docutils literal notranslate"><span class="pre">parser</span></code> 的更多内容，可以参考<a class="reference external" href="https://modelscope.github.io/agentscope/en/tutorial/203-parser.html">这里</a>.</p>
</section>
<section id="pipeline-msghub">
<h4>使用 Pipeline 和 MsgHub<a class="headerlink" href="#pipeline-msghub" title="Link to this heading"></a></h4>
<p>为了简化agent通信的构建，AgentScope提供了两个有用的概念：Pipeline和MsgHub。</p>
<ul>
<li><p><strong>Pipeline</strong>：它能让用户轻松地编程实现agent之间的不同通信编排。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">agentscope.pipelines</span> <span class="kn">import</span> <span class="n">SequentialPipeline</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">SequentialPipeline</span><span class="p">(</span><span class="n">agent1</span><span class="p">,</span> <span class="n">agent2</span><span class="p">,</span> <span class="n">agent3</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">pipe</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># the message x will be passed and replied by agent 1,2,3 in order</span>
</pre></div>
</div>
</li>
<li><p><strong>MsgHub</strong>：您可能已经注意到，上述所有例子都是一对一通信。为了实现群聊，我们提供了另一个通信辅助工具msghub。有了它，参与者的消息将自动广播给所有其他参与者。在这种情况下，参与agent甚至不需要输入和输出消息。我们需要做的只是决定发言的顺序。此外，msghub还支持参与者的动态控制。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">msghub</span><span class="p">(</span><span class="n">participants</span><span class="o">=</span><span class="p">[</span><span class="n">agent1</span><span class="p">,</span> <span class="n">agent2</span><span class="p">,</span> <span class="n">agent3</span><span class="p">])</span> <span class="k">as</span> <span class="n">hub</span><span class="p">:</span>
    <span class="n">agent1</span><span class="p">()</span>
    <span class="n">agent2</span><span class="p">()</span>

    <span class="c1"># Broadcast a message to all participants</span>
    <span class="n">hub</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="n">Msg</span><span class="p">(</span><span class="s2">&quot;Host&quot;</span><span class="p">,</span> <span class="s2">&quot;Welcome to join the group chat!&quot;</span><span class="p">))</span>

    <span class="c1"># Add or delete participants dynamically</span>
    <span class="n">hub</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">agent1</span><span class="p">)</span>
    <span class="n">hub</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">agent4</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id4">
<h4>实现狼人杀的游戏流程<a class="headerlink" href="#id4" title="Link to this heading"></a></h4>
<p>游戏逻辑分为两个主要阶段：(1)夜晚，狼人行动；以及(2)白天，所有玩家讨论和投票。每个阶段都将通过使用pipelines来管理多agent通信的代码部分来处理。</p>
<ul class="simple">
<li><p><strong>1.1 夜晚阶段：狼人讨论和投票</strong></p></li>
</ul>
<p>在夜晚阶段，狼人必须相互讨论以决定一个要杀死的目标。msghub函数为狼人之间的通信创建了一个消息中心，其中每个agent发送的消息都能被msghub内的所有其他agent观察到。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># start the game</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">MAX_GAME_ROUND</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="c1"># Night phase: werewolves discuss</span>
    <span class="n">hint</span> <span class="o">=</span> <span class="n">HostMsg</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">Prompts</span><span class="o">.</span><span class="n">to_wolves</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n2s</span><span class="p">(</span><span class="n">wolves</span><span class="p">)))</span>
    <span class="k">with</span> <span class="n">msghub</span><span class="p">(</span><span class="n">wolves</span><span class="p">,</span> <span class="n">announcement</span><span class="o">=</span><span class="n">hint</span><span class="p">)</span> <span class="k">as</span> <span class="n">hub</span><span class="p">:</span>
      	<span class="n">set_parsers</span><span class="p">(</span><span class="n">wolves</span><span class="p">,</span> <span class="n">Prompts</span><span class="o">.</span><span class="n">wolves_discuss_parser</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MAX_WEREWOLF_DISCUSSION_ROUND</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">sequentialpipeline</span><span class="p">(</span><span class="n">wolves</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;finish_discussion&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">break</span>
</pre></div>
</div>
<p>讨论结束后，根据少数服从多数，狼人进行投票选出他们的目标。然后，投票的结果将广播给所有狼人。</p>
<p>注意：具体的提示和实用函数可以在<code class="docutils literal notranslate"><span class="pre">examples/game_werewolf</span></code>中找到。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="c1"># werewolves vote</span>
        <span class="n">set_parsers</span><span class="p">(</span><span class="n">wolves</span><span class="p">,</span> <span class="n">Prompts</span><span class="o">.</span><span class="n">wolves_vote_parser</span><span class="p">)</span>
        <span class="n">hint</span> <span class="o">=</span> <span class="n">HostMsg</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">Prompts</span><span class="o">.</span><span class="n">to_wolves_vote</span><span class="p">)</span>
        <span class="n">votes</span> <span class="o">=</span> <span class="p">[</span><span class="n">extract_name_and_id</span><span class="p">(</span><span class="n">wolf</span><span class="p">(</span><span class="n">hint</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">wolf</span> <span class="ow">in</span> <span class="n">wolves</span><span class="p">]</span>
        <span class="c1"># broadcast the result to werewolves</span>
        <span class="n">dead_player</span> <span class="o">=</span> <span class="p">[</span><span class="n">majority_vote</span><span class="p">(</span><span class="n">votes</span><span class="p">)]</span>
        <span class="n">hub</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span>
            <span class="n">HostMsg</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">Prompts</span><span class="o">.</span><span class="n">to_wolves_res</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dead_player</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
        <span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>1.2 女巫的回合</strong></p></li>
</ul>
<p>如果女巫还活着，她就有机会使用她的力量：救被狼人选中的（被杀的）玩家，或使用她的毒药去杀一位玩家。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># Witch&#39;s turn</span>
    <span class="n">healing_used_tonight</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">witch</span> <span class="ow">in</span> <span class="n">survivors</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">healing</span><span class="p">:</span>
            <span class="c1"># Witch decides whether to use the healing potion</span>
            <span class="n">hint</span> <span class="o">=</span> <span class="n">HostMsg</span><span class="p">(</span>
                <span class="n">content</span><span class="o">=</span><span class="n">Prompts</span><span class="o">.</span><span class="n">to_witch_resurrect</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span>
                    <span class="p">{</span><span class="s2">&quot;witch_name&quot;</span><span class="p">:</span> <span class="n">witch</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;dead_name&quot;</span><span class="p">:</span> <span class="n">dead_player</span><span class="p">[</span><span class="mi">0</span><span class="p">]},</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="c1"># Witch decides whether to use the poison</span>
            <span class="n">set_parsers</span><span class="p">(</span><span class="n">witch</span><span class="p">,</span> <span class="n">Prompts</span><span class="o">.</span><span class="n">witch_resurrect_parser</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">witch</span><span class="p">(</span><span class="n">hint</span><span class="p">)</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;resurrect&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">healing_used_tonight</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">dead_player</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">healing</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>1.3 预言家的回合</strong></p></li>
</ul>
<p>预言家有机会揭示一名玩家的真实身份。这信息对于村民方来说可能至关重要。<code class="docutils literal notranslate"><span class="pre">observe()</span></code>函数允许每个agent注意到一个消息，而不需要立即产生回复。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># Seer&#39;s turn</span>
    <span class="k">if</span> <span class="n">seer</span> <span class="ow">in</span> <span class="n">survivors</span><span class="p">:</span>
        <span class="c1"># Seer chooses a player to reveal their identity</span>
        <span class="n">hint</span> <span class="o">=</span> <span class="n">HostMsg</span><span class="p">(</span>
            <span class="n">content</span><span class="o">=</span><span class="n">Prompts</span><span class="o">.</span><span class="n">to_seer</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">seer</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">n2s</span><span class="p">(</span><span class="n">survivors</span><span class="p">)),</span>
        <span class="p">)</span>
        <span class="n">set_parsers</span><span class="p">(</span><span class="n">seer</span><span class="p">,</span> <span class="n">Prompts</span><span class="o">.</span><span class="n">seer_parser</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">seer</span><span class="p">(</span><span class="n">hint</span><span class="p">)</span>

        <span class="n">player</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">extract_name_and_id</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="n">role</span> <span class="o">=</span> <span class="s2">&quot;werewolf&quot;</span> <span class="k">if</span> <span class="n">roles</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;werewolf&quot;</span> <span class="k">else</span> <span class="s2">&quot;villager&quot;</span>
        <span class="n">hint</span> <span class="o">=</span> <span class="n">HostMsg</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">Prompts</span><span class="o">.</span><span class="n">to_seer_result</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">role</span><span class="p">))</span>
        <span class="n">seer</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">hint</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>1.4 更新存活玩家</strong></p></li>
</ul>
<p>根据夜间采取的行动，程序需要更新幸存玩家的列表。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># Update the list of survivors and werewolves after the night&#39;s events</span>
    <span class="n">survivors</span><span class="p">,</span> <span class="n">wolves</span> <span class="o">=</span> <span class="n">update_alive_players</span><span class="p">(</span><span class="n">survivors</span><span class="p">,</span> <span class="n">wolves</span><span class="p">,</span> <span class="n">dead_player</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>2.1 白天阶段：讨论和投票</strong></p></li>
</ul>
<p>在白天，所有存活玩家将讨论然后投票以淘汰一名疑似狼人的玩家。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># Daytime discussion</span>
    <span class="k">with</span> <span class="n">msghub</span><span class="p">(</span><span class="n">survivors</span><span class="p">,</span> <span class="n">announcement</span><span class="o">=</span><span class="n">hints</span><span class="p">)</span> <span class="k">as</span> <span class="n">hub</span><span class="p">:</span>
        <span class="c1"># Discuss</span>
        <span class="n">set_parsers</span><span class="p">(</span><span class="n">survivors</span><span class="p">,</span> <span class="n">Prompts</span><span class="o">.</span><span class="n">survivors_discuss_parser</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">sequentialpipeline</span><span class="p">(</span><span class="n">survivors</span><span class="p">)</span>
        <span class="c1"># Vote</span>
        <span class="n">set_parsers</span><span class="p">(</span><span class="n">survivors</span><span class="p">,</span> <span class="n">Prompts</span><span class="o">.</span><span class="n">survivors_vote_parser</span><span class="p">)</span>
        <span class="n">hint</span> <span class="o">=</span> <span class="n">HostMsg</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">Prompts</span><span class="o">.</span><span class="n">to_all_vote</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n2s</span><span class="p">(</span><span class="n">survivors</span><span class="p">)))</span>
        <span class="n">votes</span> <span class="o">=</span> <span class="p">[</span><span class="n">extract_name_and_id</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="n">hint</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">survivors</span><span class="p">]</span>
        <span class="n">vote_res</span> <span class="o">=</span> <span class="n">majority_vote</span><span class="p">(</span><span class="n">votes</span><span class="p">)</span>
        <span class="c1"># Broadcast the voting result to all players</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">HostMsg</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">Prompts</span><span class="o">.</span><span class="n">to_all_res</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vote_res</span><span class="p">))</span>
        <span class="n">hub</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="c1"># Update the list of survivors and werewolves after the vote</span>
        <span class="n">survivors</span><span class="p">,</span> <span class="n">wolves</span> <span class="o">=</span> <span class="n">update_alive_players</span><span class="p">(</span><span class="n">survivors</span><span class="p">,</span> <span class="n">wolves</span><span class="p">,</span> <span class="n">vote_res</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>2.2 检查胜利条件</strong></p></li>
</ul>
<p>每个阶段结束后，游戏会检查是狼人还是村民获胜。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="c1"># Check if either side has won</span>
        <span class="k">if</span> <span class="n">check_winning</span><span class="p">(</span><span class="n">survivors</span><span class="p">,</span> <span class="n">wolves</span><span class="p">,</span> <span class="s2">&quot;Moderator&quot;</span><span class="p">):</span>
            <span class="k">break</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>2.3 继续到下一轮</strong></p></li>
</ul>
<p>如果狼人和村民都没有获胜，游戏将继续到下一轮。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="c1"># If the game hasn&#39;t ended, prepare for the next round</span>
        <span class="n">hub</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="n">HostMsg</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">Prompts</span><span class="o">.</span><span class="n">to_all_continue</span><span class="p">))</span>
</pre></div>
</div>
<p>这些代码块展现了使用AgentScope的<code class="docutils literal notranslate"><span class="pre">msghub</span></code>和<code class="docutils literal notranslate"><span class="pre">pipeline</span></code>的狼人游戏的核心游戏循环，这些工具有助于轻松管理应用程序的操作逻辑。</p>
</section>
</section>
<section id="id5">
<h3>第五步：运行应用<a class="headerlink" href="#id5" title="Link to this heading"></a></h3>
<p>完成了以上游戏逻辑和agent的设置，您已经可以运行狼人游戏了。通过执行<code class="docutils literal notranslate"><span class="pre">pipeline</span></code>，游戏将按预定义的阶段进行，agents
基于它们的角色和上述编码的策略进行互动：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>examples/game_werewolf
python<span class="w"> </span>main.py<span class="w">  </span><span class="c1"># Assuming the pipeline is implemented in main.py</span>
</pre></div>
</div>
<p>建议您在在 <a class="reference external" href="https://modelscope.github.io/agentscope/zh_CN/tutorial/209-gui.html">AgentScope Studio</a> 中启动游戏，在对应的链接中您将看到下面的内容输出。</p>
<p><img alt="s" src="https://img.alicdn.com/imgextra/i3/O1CN01n2Q2tR1aCFD2gpTdu_!!6000000003293-1-tps-960-482.gif" /></p>
<p><a class="reference internal" href="#usecase-zh">[返回顶部]</a></p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="207-monitor.html" class="btn btn-neutral float-left" title="监控" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="contribute.html" class="btn btn-neutral float-right" title="参与贡献" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2024, Alibaba Tongyi Lab。</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>